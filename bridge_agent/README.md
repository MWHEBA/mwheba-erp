# Biometric Bridge Agent v2.0

ูููู ุขูู ูุฑุจุท ูุงูููุฉ ุงูุจุตูุฉ ZKTeco ุจุงูุณูุฑูุฑ - ูุนูู ูุฎุฏูุฉ ูููุฏูุฒ ูู ุงูุฎูููุฉ

## โจ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ (v2.0)

- โ **ุฅุฑุณุงู ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ ููุท** - ุชูููุฑ bandwidth ูููุงุฑุฏ
- โ **ูุธุงู Heartbeat** - ุงูุจุงุฏุฌ ุฏุงุฆูุงู ูุนูุณ ุงูุญุงูุฉ ุงูุตุญูุญุฉ
- โ **ุญูุธ ุขุฎุฑ timestamp** - ุงุณุชูุฑุงุฑูุฉ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู
- โ **ุชุญุฏูุซ ุชููุงุฆู ููุญุงูุฉ** - last_connection ูุชุญุฏุซ ูู 5 ุฏูุงุฆู

---

## ุงูุชุซุจูุช ุงูุชููุงุฆู (3 ุฎุทูุงุช ููุท!)

### 1. ุชุญููู Bridge Agent
- ุญููู ุงูููู ูู ุงููุธุงู (ุตูุญุฉ ุงูุฌูุงุฒ โ ุฅุนุฏุงุฏ Bridge Agent)
- ุงุณุชุฎุฑุฌ ุงููููุงุช ูู ููุงู ุซุงุจุช (ูุซูุงู: `C:\BridgeAgent`)

### 2. ุชุซุจูุช ูุฎุฏูุฉ ูููุฏูุฒ
```bash
# ูููู ูููู ุนูู install_service.bat โ Run as administrator
install_service.bat
```

**ุงูุณูุฑูุจุช ุณูููู ุจูู ุดูุก ุชููุงุฆูุงู:**
- โ ุชุญููู ูุชุซุจูุช NSSM (ุฃุฏุงุฉ ุงูุฎุฏูุฉ)
- โ ุงูุชุญูู ูู Python ูุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ
- โ ุชุซุจูุช ูุชุดุบูู ุงูุฎุฏูุฉ
- โ ุถุจุท ุงูุชุดุบูู ุงูุชููุงุฆู ูุน ุงููููุฏูุฒ

### 3. ุชู! ๐
ุงูุฎุฏูุฉ ุงูุขู ุชุนูู ูู ุงูุฎูููุฉ ูุชุฒุงูู ุงูุจูุงูุงุช ูู 5 ุฏูุงุฆู

---

## ุฃูุงูุฑ ุฅุฏุงุฑุฉ ุงูุฎุฏูุฉ

### ุทุฑููุฉ ุณููุฉ (ูููุงุช BAT):
```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ (ุจุนุฏ ุงูุชุญุฏูุซุงุช)
RESTART_SERVICE.bat  # ูู Administrator

# ุฅูุบุงุก ุชุซุจูุช ุงูุฎุฏูุฉ
uninstall_service.bat  # ูู Administrator
```

### ุทุฑููุฉ ูุชูุฏูุฉ (NSSM):
```bash
# ุชุดุบูู ุงูุฎุฏูุฉ
nssm start BiometricBridge

# ุฅููุงู ุงูุฎุฏูุฉ
nssm stop BiometricBridge

# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ
nssm restart BiometricBridge

# ุญุงูุฉ ุงูุฎุฏูุฉ
nssm status BiometricBridge
```

### ุทุฑููุฉ PowerShell:
```powershell
# ูุญุต ุงูุญุงูุฉ
Get-Service BiometricBridge

# ุฅุนุงุฏุฉ ุชุดุบูู
Restart-Service BiometricBridge  # ูู Administrator
```

---

## ูููุงุช ุงูุณุฌูุงุช ูุงูุจูุงูุงุช

```
C:\BridgeAgent\
โโโ bridge_agent.log     โ ุณุฌู ุงููุฒุงููุฉ (ุฑุฆูุณูุ ุญุฏ ุฃูุตู 5 MB)
โโโ bridge_agent.log.1   โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ 1 (ุชููุงุฆู)
โโโ bridge_agent.log.2   โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ 2 (ุชููุงุฆู)
โโโ bridge_agent.log.3   โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ 3 (ุชููุงุฆู)
โโโ last_sync.json       โ ุขุฎุฑ ููุช ูุฒุงููุฉ (ุฌุฏูุฏ v2.0)
โโโ config.json          โ ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู
โโโ service.log          โ ุณุฌู ุงูุฎุฏูุฉ (NSSM)
โโโ service_error.log    โ ุฃุฎุทุงุก ุงูุฎุฏูุฉ (NSSM)
```

### ูุธุงู Log Rotation (ุฌุฏูุฏ v2.0):
- **ุงูุญุฏ ุงูุฃูุตู:** 5 MB ููู ููู
- **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ:** 3 ูููุงุช
- **ุงูุชููุงุฆู:** ูุฏูุฑ ุชููุงุฆูุงู ุนูุฏ ุงููุตูู ููุญุฏ
- **ุงูุฅุฌูุงูู:** ุญุฏ ุฃูุตู 20 MB (5 MB ร 4 ูููุงุช)

### ูุฑุงูุจุฉ Logs ูุจุงุดุฑุฉ:
```powershell
# ูุฑุงูุจุฉ ุณุฌู ุงููุฒุงููุฉ
Get-Content C:\BridgeAgent\bridge_agent.log -Tail 20 -Wait

# ุนุฑุถ ุฌููุน ูููุงุช ุงูุณุฌูุงุช
Get-ChildItem C:\BridgeAgent\*.log | Sort-Object LastWriteTime -Descending
```

---

## ุงูุฅุนุฏุงุฏุงุช ุนูู ุงูุณูุฑูุฑ

```python
# ูู .env
BRIDGE_AGENTS=AGENT-001:your-secret-key-here

# ุฃู ูู settings.py
BRIDGE_AGENTS = {
    'AGENT-001': 'your-secret-key-here'
}
```

---

## ุงููุชุทูุจุงุช

- โ Windows 7 ุฃู ุฃุญุฏุซ
- โ Python 3.8 ุฃู ุฃุญุฏุซ (ูุชู ุงูุชุญูู ุชููุงุฆูุงู)
- โ ุงุชุตุงู ุจุงูุฅูุชุฑูุช (ููุชุซุจูุช ููุท)
- โ ุตูุงุญูุงุช Administrator (ููุชุซุจูุช ููุท)

---

## ุงูููุชุจุงุช ุงููุณุชุฎุฏูุฉ

- `pyzk` - ููุงุชุตุงู ุจุฃุฌูุฒุฉ ZKTeco
- `requests` - ููุงุชุตุงู ุจุงูุณูุฑูุฑ
- `schedule` - ูุฌุฏููุฉ ุงููุฒุงููุฉ

---

## ููู ูุนูู ุงููุธุงู ุงูุฌุฏูุฏ (v2.0)

### ุงููุฒุงููุฉ ุงูุฐููุฉ:
```
ูู 5 ุฏูุงุฆู:
1. ูุชุตู ุจุงููุงูููุฉ โ
2. ูุฌูุจ ุงูุณุฌูุงุช โ
3. ูููุชุฑ ุงููุฏููุฉ (ูู last_sync.json) โ
4. ูุฑุณู ุงูุฌุฏูุฏุฉ ููุท ููุณูุฑูุฑ โ
5. ูุญุฏุซ last_connection (ุฏุงุฆูุงู) โ
```

### ูู ููู ุณุฌูุงุช ุฌุฏูุฏุฉ:
```
Log: "โ Sync completed successfully"
- ูุฑุณู ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ
- ูุญุฏุซ last_sync.json
- ูุญุฏุซ last_connection ูู ุงูุณูุฑูุฑ
```

### ูู ูุงููุด ุณุฌูุงุช ุฌุฏูุฏุฉ:
```
Log: "โ Heartbeat sent - No new records"
- ูุฑุณู heartbeat ููุณูุฑูุฑ
- ูุญุฏุซ last_connection (ุงูุจุงุฏุฌ ูุจูู ุฃุฎุถุฑ)
- ูุด ุจูุญุฏุซ last_sync.json
```

---

## ุงูุฃูุงู

- ๐ HMAC-based authentication
- ๐ Bearer token ููู API
- ๐ ุงุชุตุงู HTTPS ูุน ุงูุณูุฑูุฑ (Production)
- ๐ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ๐ ุณุฌูุงุช ููุตูุฉ ูููุฑุงุฌุนุฉ

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงูุฎุฏูุฉ ูุง ุชุนูู:
```bash
# ุชุญูู ูู ุงูุญุงูุฉ
nssm status BiometricBridge

# ุดุงูุฏ ุขุฎุฑ ุฃุฎุทุงุก
type C:\BridgeAgent\service_error.log
```

### ูุง ุชูุฌุฏ ูุฒุงููุฉ:
```bash
# ุชุญูู ูู ุงูุณุฌู
type C:\BridgeAgent\bridge_agent.log

# ุชุญูู ูู config.json
type C:\BridgeAgent\config.json
```

### ุงูุจุงุฏุฌ ูุธูุฑ "ุบูุฑ ูุชุตู":
```bash
# ุชุญูู ูู ุขุฎุฑ heartbeat
type C:\BridgeAgent\bridge_agent.log | findstr "Heartbeat"

# ุฃุนุฏ ุชุดุบูู ุงูุฎุฏูุฉ
RESTART_SERVICE.bat
```

---

## ุงูุชุญุฏูุซ ูู v1.0 ุฅูู v2.0

1. ุฃููู ุงูุฎุฏูุฉ ุงููุฏููุฉ
2. ุงุณุชุจุฏู `agent.py` ุจุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ
3. ุดุบู `RESTART_SERVICE.bat`
4. ุฑุงูุจ ุงูุณุฌู ููุชุฃูุฏ ูู ุงูุนูู

**ููุงุญุธุฉ:** ุณูุชู ุฅูุดุงุก `last_sync.json` ุชููุงุฆูุงู ุนูุฏ ุฃูู ูุฒุงููุฉ
