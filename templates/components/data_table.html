{% load static %}
{% load i18n %}
{% load pricing_filters %}
{% load utils_extras %}

{% comment %}
Ù…ÙƒÙˆÙ† Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ ØµÙØ­Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„ÙÙ„ØªØ±Ø©

Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
{% include "components/data_table.html" with table_id="products-table" headers=headers data=products %}

Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª:
- table_id: Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "data-table")
- headers: Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© [{'key': 'name', 'label': 'Ø§Ù„Ø§Ø³Ù…', 'sortable': True, 'width': '10%', 'class': 'text-center'}, ...] 
- data: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
- empty_message: Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶")
- table_class: ØªØµÙ†ÙŠÙØ§Øª CSS Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- primary_key: Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ…ÙØªØ§Ø­ Ø£Ø³Ø§Ø³ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "id")
- action_buttons: Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø«Ù„ [{'url': 'edit_url', 'icon': 'fa-edit', 'label': 'ØªØ¹Ø¯ÙŠÙ„', 'class': 'action-edit'}]
- responsive: Ù‡Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø³ØªØ¬ÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- sortable: Ù‡Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ±ØªÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- current_order_by: Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ±ØªÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "")
- current_order_dir: Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ "")
- row_class_callback: Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„ØµÙÙˆÙ ØªØ¨Ø¹Ø§Ù‹ Ù„Ù…Ø­ØªÙˆØ§Ù‡Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- show_currency: Ù‡Ù„ ØªØ¸Ù‡Ø± Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ False)
- currency_symbol: Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)
- hover_effect: Ù‡Ù„ ØªØ¸Ù‡Ø± ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- show_search: Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- show_length_menu: Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ True)
- length_options: Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± [10, 25, 50, 100] (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- clickable_rows: Ø¬Ø¹Ù„ Ø§Ù„ØµÙÙˆÙ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ False)
- row_click_url: URL Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- show_export: Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ False)
- export_filename: Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù„Ù„ØªØµØ¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ table_data)
{% endcomment %}

{% if data %}
{% if show_search|default:True or show_length_menu|default:True %}
<div class="table-controls mb-3">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
        {% if show_length_menu|default:True %}
        <div class="table-length-control d-flex align-items-center">
            <span class="length-label me-2">{% trans "Ø¹Ø±Ø¶" %}</span>
            <select class="form-select form-select-sm table-length" data-table="{{ table_id|default:'data-table' }}" aria-label="{% trans 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±' %}">
                {% for option in length_options|default:"10,25,50,100"|split:"," %}
                <option value="{{ option }}" {% if option == '25' %}selected{% endif %}>{{ option }}</option>
                {% endfor %}
            </select>
            <span class="length-label ms-2">{% trans "Ø¹Ù†ØµØ±" %}</span>
        </div>
        {% endif %}
        
        {% if show_search|default:True %}
        <div class="table-search-control">
            <div class="input-group">
                <input type="text" class="form-control form-control-sm table-search" placeholder="{% trans 'Ø¨Ø­Ø«...' %}" aria-label="{% trans 'Ø¨Ø­Ø«' %}" data-table="{{ table_id|default:'data-table' }}">
                <span class="input-group-text search-icon">
                    <i class="fas fa-search"></i>
                </span>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<div {% if responsive|default:True %}class="table-responsive"{% endif %}>
    <table id="{{ table_id|default:'data-table' }}" class="transaction-table table-hover table-striped {{ table_class }}" style="width: 100%">
        <thead>
            <tr>
                {% for header in headers %}
                    <th {% if header.width %}style="width: {{ header.width }};"{% endif %} class="{% if header.class %}{{ header.class }}{% endif %} col-{{ header.key }} text-center">
                        <span class="d-block text-center">{{ header.label }}</span>
                    </th>
                {% endfor %}
                {% if action_buttons %}
                    <th class="text-center col-actions">{% trans "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" %}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for item in data %}
                {% if forloop.first %}<!-- DEBUG: Ù„Ø¯ÙŠÙ†Ø§ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ¹Ù„ÙŠØ© -->{% endif %}
                    <tr {% if row_class_callback %}class="{{ item|call:row_class_callback }}"{% endif %} data-id="{{ item|get_attr:primary_key|default:'0' }}"{% if row_click_field %} data-url="{{ item|get_attr:row_click_field }}"{% endif %}>
                        {% for header in headers %}
                            {% with field_value=item|get_attr:header.key %}
                                <td class="{% if header.class %}{{ header.class }}{% endif %} col-{{ header.key }}">
                                    {% if header.template %}
                                        {% include header.template with value=field_value object=item %}
                                    {% elif header.format == 'date' %}
                                        <span class="transaction-date">{{ field_value|date:"d-m-Y" }}</span>
                                    {% elif header.format == 'datetime' %}
                                        <span class="transaction-date">{{ field_value|date:"d-m-Y H:i" }}</span>
                                    {% elif header.format == 'datetime_12h' %}
                                        <div>{{ field_value|date:"d-m-Y" }}</div>
                                        <small class="text-muted">{{ field_value|date:"h:i A" }}</small>
                                    {% elif header.format == 'currency' %}
                                        <span class="transaction-amount {% if header.variant %}{{ header.variant }}{% endif %}" style="text-align: center; width: 100%; display: block;">
                                            {% if field_value == None or field_value == '' %}
                                                <strong style="text-align: center; display: block;"><span class="text-muted">-</span></strong>
                                            {% elif field_value == 0 %}
                                                {% if header.key == 'balance' %}
                                                    <strong style="text-align: center; display: block;"><span class="text-muted">-</span></strong>
                                                {% else %}
                                                    <strong style="text-align: center; display: block;"><span class="currency-symbol">{{ currency_symbol }}</span> 0</strong>
                                                {% endif %}
                                            {% else %}
                                                <strong style="text-align: center; display: block;"><span class="currency-symbol">{{ currency_symbol }}</span> {{ field_value|smart_float }}</strong>
                                            {% endif %}
                                        </span>
                                    {% elif header.format == 'boolean' %}
                                        {% if header.key == 'is_active' %}
                                            {% if field_value %}
                                                <span class="badge bg-success">{% trans "Ù†Ø´Ø·" %}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{% trans "ØºÙŠØ± Ù†Ø´Ø·" %}</span>
                                            {% endif %}
                                        {% else %}
                                            {% if field_value %}
                                                <span class="badge bg-success">Ù†Ø¹Ù…</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Ù„Ø§</span>
                                            {% endif %}
                                        {% endif %}
                                    {% elif header.format == 'image' %}
                                        {% if field_value %}
                                            <img src="{{ field_value.url }}" alt="ØµÙˆØ±Ø©" class="img-thumbnail" style="max-width: 50px; height: auto;">
                                        {% else %}
                                            <i class="fas fa-image text-muted"></i>
                                        {% endif %}
                                    {% elif header.format == 'status' %}
                                        <div class="expense-status-cell">
                                            {% if header.key == 'is_active' %}
                                                {% if field_value %}
                                                    <span class="badge bg-success">{% trans "Ù†Ø´Ø·" %}</span>
                                                {% elif field_value == False %}
                                                    <span class="badge bg-danger">{% trans "ØºÙŠØ± Ù†Ø´Ø·" %}</span>
                                                {% else %}
                                                    <span class="badge bg-warning">{% trans "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" %} ({{ field_value|stringformat:'r' }})</span>
                                                {% endif %}
                                            
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ -->
                                            {% elif header.key == 'payment_status' %}
                                                {% if field_value == 'paid' %}
                                                    <span class="badge bg-success">{% trans "Ù…Ø¯ÙÙˆØ¹Ø©" %}</span>
                                                {% elif field_value == 'partially_paid' %}
                                                    <span class="badge bg-warning">{% trans "Ù…Ø¯ÙÙˆØ¹Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹" %}</span>
                                                {% elif field_value == 'unpaid' %}
                                                    <span class="badge bg-danger">{% trans "ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©" %}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                                            {% elif header.key == 'payment_method' %}
                                                {% if field_value == 'cash' %}
                                                    <span class="badge payment-method cash">{% trans "Ù†Ù‚Ø¯ÙŠ" %}</span>
                                                {% elif field_value == 'credit' %}
                                                    <span class="badge payment-method credit">{% trans "Ø¢Ø¬Ù„" %}</span>
                                                {% elif field_value == 'bank_transfer' %}
                                                    <span class="badge payment-method bank-transfer">{% trans "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ" %}</span>
                                                {% else %}
                                                    <span class="badge payment-method">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ -->
                                            {% elif header.key == 'return_status' %}
                                                {% if field_value == 'full' %}
                                                    <span class="badge bg-danger">{% trans "Ù…Ø±ØªØ¬Ø¹ ÙƒÙ„ÙŠ" %}</span>
                                                {% elif field_value == 'partial' %}
                                                    <span class="badge bg-warning">{% trans "Ù…Ø±ØªØ¬Ø¹ Ø¬Ø²Ø¦ÙŠ" %}</span>
                                                {% elif not field_value %}
                                                    <span class="text-muted">-</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                                            {% elif header.key == 'status' and 'warehouse' in request.resolver_match.url_name %}
                                                {% if field_value == 'Ù…ØªÙˆÙØ±' %}
                                                    <span class="badge bg-success">{{ field_value }}</span>
                                                {% elif field_value == 'Ù…Ù†Ø®ÙØ¶' %}
                                                    <span class="badge bg-warning">{{ field_value }}</span>
                                                {% elif field_value == 'Ù†ÙØ¯' %}
                                                    <span class="badge bg-danger">{{ field_value }}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ field_value }}</span>
                                                {% endif %}
                                                
                                            <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© -->
                                            {% elif field_value == 'posted' %}
                                                <span class="badge bg-success">Ù…Ø±Ø­Ù„</span>
                                            {% elif field_value == 'draft' %}
                                                <span class="badge bg-warning">Ù…Ø³ÙˆØ¯Ø©</span>
                                            {% elif field_value == 'paid' %}
                                                <span class="badge bg-success">{% trans "Ù…Ø¯ÙÙˆØ¹" %}</span>
                                            {% elif field_value == 'pending' %}
                                                <span class="badge bg-warning">{% trans "Ù…Ø¹Ù„Ù‚" %}</span>
                                            {% elif field_value == 'received' %}
                                                <span class="badge bg-success">{% trans "Ù…Ø³ØªÙ„Ù…" %}</span>
                                            {% elif field_value == 'cancelled' %}
                                                <span class="badge bg-danger">{% trans "Ù…Ù„ØºÙŠ" %}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{{ field_value }}</span>
                                            {% endif %}
                                        </div>
                                    {% elif header.format == 'reference' %}
                                        {% if field_value %}
                                            {% if header.variant == 'highlight-code' %}
                                                <div class="transaction-ref text-center">
                                                    {% if header.key == 'reference_number' or header.key == 'number' %}
                                                        {% if header.app == 'purchase' %}
                                                        <a href="{% url 'purchase:purchase_detail' item|get_attr:primary_key|default:'0' %}" class="text-decoration-none">
                                                        {% elif header.app == 'sale' %}
                                                        <a href="{% url 'sale:sale_detail' item|get_attr:primary_key|default:'0' %}" class="text-decoration-none">
                                                        {% else %}
                                                        <a href="#" class="text-decoration-none">
                                                        {% endif %}
                                                            <span class="badge invoice-number"><i class="fas fa-file-invoice me-1"></i> {{ field_value }}</span>
                                                        </a>
                                                    {% else %}
                                                        <span class="badge invoice-number"><i class="fas fa-file-invoice me-1"></i> {{ field_value }}</span>
                                                    {% endif %}
                                                </div>
                                            {% else %}
                                                <div class="transaction-ref text-center">{{ field_value }}</div>
                                            {% endif %}
                                        {% else %}
                                            <strong style="text-align: center; display: block;"><span class="text-muted">-</span></strong>
                                        {% endif %}
                                    {% elif header.format == 'icon_text' %}
                                        <div class="d-flex align-items-center">
                                            {% if header.icon_callback %}
                                                <div class="transaction-icon {{ item|call:header.icon_callback }}">
                                                    <i class="fas {{ item|call:header.icon_class_callback }}"></i>
                                                </div>
                                            {% endif %}
                                            <div {% if header.icon_callback %}class="transaction-type-text me-2"{% endif %}>
                                                {% if header.key == 'transaction_type' %}
                                                    {{ item|call:"get_transaction_type_display" }}
                                                {% else %}
                                                    {{ field_value }}
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% elif header.format == 'link' %}
                                        {% if header.url and field_value %}
                                            <a href="{% url header.url item|get_attr:primary_key|default:'0' %}" class="text-decoration-none fw-bold text-primary">
                                                {{ field_value }}
                                            </a>
                                        {% else %}
                                            {{ field_value|default:"-" }}
                                        {% endif %}
                                    {% elif header.format == 'html' %}
                                        {{ field_value|safe }}
                                    {% elif header.format == 'rating' %}
                                        <div class="rating-display text-center">
                                            <div class="rating-stars text-warning mb-1">
                                                {% with rating=field_value|default:0|smart_float %}
                                                    {% for i in "12345" %}
                                                        {% if forloop.counter <= rating|add:0 %}
                                                            <i class="fas fa-star"></i>
                                                        {% else %}
                                                            <i class="far fa-star"></i>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endwith %}
                                            </div>
                                            <small class="text-muted">{{ field_value|default:0 }}/5</small>
                                        </div>
                                    {% elif header.format == 'boolean_badge' %}
                                        {% if field_value %}
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-star me-1"></i>Ù…ÙØ¶Ù„
                                            </span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    {% elif header.key == 'entry_type' %}
                                        <!-- Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ -->
                                        {% if field_value == 'Ø¥ÙŠØ±Ø§Ø¯ Ù†Ù‚Ø¯ÙŠ' %}
                                            <span class="badge bg-success">ğŸ’µ Ø¥ÙŠØ±Ø§Ø¯ Ù†Ù‚Ø¯ÙŠ</span>
                                        {% elif field_value == 'Ù…ØµØ±ÙˆÙ Ù†Ù‚Ø¯ÙŠ' %}
                                            <span class="badge bg-danger">ğŸ’¸ Ù…ØµØ±ÙˆÙ Ù†Ù‚Ø¯ÙŠ</span>
                                        {% elif field_value == 'Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ù†ÙƒÙŠ' %}
                                            <span class="badge bg-primary">ğŸ¦ Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ù†ÙƒÙŠ</span>
                                        {% elif field_value == 'Ù…ØµØ±ÙˆÙ Ø¨Ù†ÙƒÙŠ' %}
                                            <span class="badge bg-warning">ğŸ§ Ù…ØµØ±ÙˆÙ Ø¨Ù†ÙƒÙŠ</span>
                                        {% elif field_value == 'ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª' %}
                                            <span class="badge bg-success">ğŸ“„ ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                                        {% elif field_value == 'ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª' %}
                                            <span class="badge bg-info">ğŸ›’ ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª</span>
                                        {% elif field_value == 'ØªØ­ØµÙŠÙ„ Ù…Ù† Ø¹Ù…ÙŠÙ„' %}
                                            <span class="badge bg-primary">ğŸ’° ØªØ­ØµÙŠÙ„ Ù…Ù† Ø¹Ù…ÙŠÙ„</span>
                                        {% elif field_value == 'Ø¯ÙØ¹ Ù„Ù…ÙˆØ±Ø¯' %}
                                            <span class="badge bg-warning">ğŸ’³ Ø¯ÙØ¹ Ù„Ù…ÙˆØ±Ø¯</span>
                                        {% elif field_value == 'Ù‚ÙŠØ¯ Ù…Ø±ÙƒØ¨' %}
                                            <span class="badge bg-secondary">ğŸ”— Ù‚ÙŠØ¯ Ù…Ø±ÙƒØ¨</span>
                                        {% elif field_value == 'ØªØ­ÙˆÙŠÙ„' %}
                                            <span class="badge bg-info">ğŸ”„ ØªØ­ÙˆÙŠÙ„</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ field_value }}</span>
                                        {% endif %}
                                    {% else %}
                                        {% if header.ellipsis|default:False %}
                                            <div class="description">{{ field_value|default:"-" }}</div>
                                        {% else %}
                                            {% if field_value == None or field_value == '' %}
                                                <span class="text-muted">-</span>
                                            {% else %}
                                                {{ field_value }}
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                </td>
                            {% endwith %}
                        {% endfor %}
                        
                        {% if action_buttons %}
                            <td class="text-center col-actions">
                                <div class="d-flex justify-content-center">
                                    {% for button in action_buttons %}
                                        {% comment %} Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø±Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ {% endcomment %}
                                        {% if button.condition == 'not_fully_paid' %}
                                            {% if item.payment_status != 'paid' %}
                                                {% if ':' in button.url %}
                                                    {% with url_name=button.url %}
                                                        <a href="{% url url_name item|get_attr:primary_key|default:'0' %}" 
                                                           class="action-button {{ button.class|default:'action-view' }}" 
                                                           title="{{ button.label }}"
                                                           {% if button.data_attrs %}{{ button.data_attrs|safe }}{% endif %}>
                                                            <i class="fas {{ button.icon }}"></i>
                                                        </a>
                                                    {% endwith %}
                                                {% else %}
                                                    <a href="#" onclick="alert('ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ù„ÙˆØ¨')" 
                                                       class="action-button {{ button.class|default:'action-view' }}" 
                                                       title="{{ button.label }}"
                                                       {% if button.data_attrs %}{{ button.data_attrs|safe }}{% endif %}>
                                                        <i class="fas {{ button.icon }}"></i>
                                                    </a>
                                                {% endif %}
                                            {% endif %}
                                        {% elif button.condition == 'no_posted_payments' %}
                                            {% if not item.has_posted_payments %}
                                                {% if ':' in button.url %}
                                                    {% with url_name=button.url %}
                                                        <a href="{% url url_name item|get_attr:primary_key|default:'0' %}" 
                                                           class="action-button {{ button.class|default:'action-view' }}" 
                                                           title="{{ button.label }}"
                                                           {% if button.data_attrs %}{{ button.data_attrs|safe }}{% endif %}>
                                                            <i class="fas {{ button.icon }}"></i>
                                                        </a>
                                                    {% endwith %}
                                                {% else %}
                                                    <a href="#" onclick="alert('ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ù„ÙˆØ¨')" 
                                                       class="action-button {{ button.class|default:'action-view' }}" 
                                                       title="{{ button.label }}"
                                                       {% if button.data_attrs %}{{ button.data_attrs|safe }}{% endif %}>
                                                        <i class="fas {{ button.icon }}"></i>
                                                    </a>
                                                {% endif %}
                                            {% endif %}
                                        {% else %}
                                            {% comment %} Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø· {% endcomment %}
                                            {% if ':' in button.url %}
                                                {% with url_name=button.url %}
                                                    <a href="{% url url_name item|get_attr:primary_key|default:'0' %}" 
                                                       class="action-button {{ button.class|default:'action-view' }}" 
                                                       title="{{ button.label }}"
                                                       {% if button.data_attrs %}{{ button.data_attrs|safe }}{% endif %}>
                                                        <i class="fas {{ button.icon }}"></i>
                                                    </a>
                                                {% endwith %}
                                            {% else %}
                                                <a href="#" onclick="alert('ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ù„ÙˆØ¨')" 
                                                   class="action-button {{ button.class|default:'action-view' }}" 
                                                   title="{{ button.label }}"
                                                   {% if button.data_attrs %}{{ button.data_attrs|safe }}{% endif %}>
                                                    <i class="fas {{ button.icon }}"></i>
                                                </a>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </td>
                        {% endif %}
                    </tr>
                {% empty %}
                <!-- DEBUG: Ø§Ù„Ù€ for loop ÙØ§Ø±Øº - Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª -->
                <tr>
                    <td colspan="{% if action_buttons %}{{ headers|length|add:1 }}{% else %}{{ headers|length }}{% endif %}" class="text-center py-5">
                        <div class="empty-state-icon mb-3">
                            <i class="fas fa-table fa-2x text-muted" style="opacity: 0.6;"></i>
                        </div>
                        <h5 class="text-muted mb-2">{{ empty_message|default:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶" }}</h5>
                        <p class="text-muted small">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
                    </td>
                </tr>
                {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<!-- DEBUG: ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± - data={{ data|default:"None" }} -->
<!-- Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§Ø±Øº -->
<div class="empty-table-notice text-center py-5" style="border: 2px dashed #ccc; background-color: #f8f9fa;">
    <div class="empty-state-icon mb-3">
        <i class="fas fa-table fa-sm text-muted" style="opacity: 0.5;"></i>
    </div>
    <h4 class="empty-state-title text-muted mb-2">{{ empty_message|default:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶" }}</h4>
    <p class="text-muted">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
</div>
{% endif %}

{% if show_export|default:False and data %}
<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
<div class="d-flex justify-content-end mt-3">
    <button type="button" class="btn btn-sm btn-outline-secondary btn-export-table me-2" data-table="{{ table_id|default:'data-table' }}" data-filename="{{ export_filename|default:'table_data' }}.csv">
        <i class="fas fa-file-csv me-1"></i>{% trans "ØªØµØ¯ÙŠØ± CSV" %}
    </button>
    <button type="button" class="btn btn-sm btn-outline-success btn-export-excel" data-table="{{ table_id|default:'data-table' }}" data-filename="{{ export_filename|default:'table_data' }}.xlsx">
        <i class="fas fa-file-excel me-1"></i>{% trans "ØªØµØ¯ÙŠØ± Excel" %}
    </button>
</div>
{% endif %}

{% if clickable_rows|default:False %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ø¬Ø¹Ù„ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±
    const tableBody = document.querySelector('#{{ table_id|default:"data-table" }} tbody');
    if (tableBody) {
        tableBody.addEventListener('click', function(e) {
            const row = e.target.closest('tr');
            if (!row) return;
            
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
            if (e.target.closest('.col-actions')) return;
            
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
            if (row.getAttribute('data-empty') === 'true') return;
            {% if row_click_field %}
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… URL Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const url = row.getAttribute('data-url');
            if (url && (url.startsWith('/') || url.startsWith(window.location.origin))) {
                window.location.href = url;
            }
            {% elif row_click_url %}
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… URL Ø«Ø§Ø¨Øª Ù…Ø¹ ID
            const itemId = row.getAttribute('data-id') || row.querySelector('td:first-child')?.textContent?.trim();
            if (itemId && /^\d+$/.test(itemId)) {
                const baseUrl = '{{ row_click_url|escapejs }}';
                const url = baseUrl.replace('0', encodeURIComponent(itemId));
                if (url.startsWith('/') || url.startsWith(window.location.origin)) {
                    window.location.href = url;
                }
            }
            {% endif %}
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„ÙŠØ¯ Ù„Ù„ØµÙÙˆÙ
        const rows = tableBody.querySelectorAll('tr:not([data-empty])');
        rows.forEach(row => {
        });
    }
});
</script>
{% endif %}

<!-- DEBUG: Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù - Ø¥Ø°Ø§ ÙˆØµÙ„Øª Ù‡Ù†Ø§ ÙØ§Ù„ÙƒÙˆØ¯ ÙŠØ¹Ù…Ù„ -->
<script>console.log('data_table.html loaded successfully');</script>