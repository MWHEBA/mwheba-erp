{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load custom_filters %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header المركزي -->
    {% include "shared/page_header.html" %}

    <div class="row">
        <!-- بطاقة معلومات النوع -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{% trans "معلومات النوع" %}</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4 text-center">
                        {% if brand.logo %}
                            <img src="{{ brand.logo.url }}" alt="{{ brand.name }}" class="img-fluid mb-3" style="max-height: 150px;">
                        {% else %}
                            <div class="p-4 bg-light rounded mb-3">
                                <i class="fas fa-image fa-4x text-muted"></i>
                                <p class="mt-2 text-muted">{% trans "لا يوجد شعار" %}</p>
                            </div>
                        {% endif %}
                        <h2 class="display-6">{{ brand.name }}</h2>
                        {% if brand.website %}
                            <a href="{{ brand.website }}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                                <i class="fas fa-external-link-alt me-1"></i>
                                {% trans "زيارة الموقع" %}
                            </a>
                        {% endif %}
                    </div>
                    
                    <hr>
                    
                    {% if brand.description %}
                    <div class="mb-3">
                        <h6>{% trans "الوصف:" %}</h6>
                        <p>{{ brand.description }}</p>
                    </div>
                    <hr>
                    {% endif %}
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>{% trans "الحالة:" %}</strong>
                        </div>
                        <div class="col-md-6">
                            {% if brand.is_active %}
                            <span class="badge bg-success">{% trans "نشط" %}</span>
                            {% else %}
                            <span class="badge bg-danger">{% trans "غير نشط" %}</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>{% trans "تاريخ الإنشاء:" %}</strong>
                        </div>
                        <div class="col-md-6">
                            {{ brand.created_at|date:"d-m-Y H:i" }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>{% trans "آخر تحديث:" %}</strong>
                        </div>
                        <div class="col-md-6">
                            {{ brand.updated_at|date:"d-m-Y H:i" }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>{% trans "عدد المنتجات:" %}</strong>
                        </div>
                        <div class="col-md-6">
                            <span class="badge bg-primary">{{ products.count }}</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <a href="{% url 'product:brand_edit' brand.pk %}" class="btn btn-warning btn-sm">
                        <i class="fas fa-edit me-1"></i> {% trans "تعديل" %}
                    </a>
                    <a href="{% url 'product:brand_delete' brand.pk %}" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash me-1"></i> {% trans "حذف" %}
                    </a>
                </div>
            </div>
        </div>
        
        <!-- قائمة المنتجات التي تستخدم هذا النوع -->
        <div class="col-md-8 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">{% trans "المنتجات المرتبطة" %}</h5>
                </div>
                <div class="card-body">
                    <!-- استخدام الجدول الموحد -->
                    {% if products %}
                      {% with table_id="brand-products-table" %}
                        {% with headers=product_headers %}
                          {% with data=products %}
                            {% with action_buttons=product_actions %}
                              {% with empty_message="لا توجد منتجات مرتبطة بهذا النوع" %}
                                {% with clickable_rows=True row_click_url="/products/0/" %}
                                  {% with show_export=True export_filename="brand_products" %}
                                    {% include "components/data_table.html" %}
                                  {% endwith %}
                                {% endwith %}
                              {% endwith %}
                            {% endwith %}
                          {% endwith %}
                        {% endwith %}
                      {% endwith %}
                    {% else %}
                      {% include 'partials/empty_state.html' with message="لا توجد منتجات مرتبطة بهذا النوع" icon="boxes" %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/global-table.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // تهيئة الجداول باستخدام النظام الموحد
    if (typeof initializeAllTables === 'function') {
        initializeAllTables();
    }
});
</script>
{% endblock %} 