<!-- نموذج خدمات الطباعة (التشطيب) -->
<div class="finishing-service-form">
    <!-- الحقول الأساسية -->
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <div class="form-floating">
                <input type="text" class="form-control" name="name" id="service-name" 
                       placeholder="اسم الخدمة" required>
                <label for="service-name">اسم الخدمة *</label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <select name="finishing_type" class="form-select" id="finishing-type" required>
                    <option value="">اختر نوع الخدمة</option>
                    {% for choice in form_choices.finishing_types %}
                        <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                    {% endfor %}
                </select>
                <label for="finishing-type">نوع الخدمة *</label>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <div class="form-floating">
                <select name="calculation_method" class="form-select" id="calculation-method" required>
                    <option value="">اختر طريقة الحساب</option>
                    {% for choice in form_choices.calculation_methods %}
                        <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                    {% endfor %}
                </select>
                <label for="calculation-method">طريقة الحساب *</label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <input type="number" class="form-control" name="price_per_unit" 
                       id="price-per-unit" placeholder="سعر الوحدة" min="0" required>
                <label for="price-per-unit">سعر الوحدة *</label>
            </div>
        </div>
    </div>

    <!-- أوقات العمل -->
    <div class="alert alert-primary">
        <h6 class="alert-heading">
            <i class="fas fa-clock me-2"></i>
            أوقات العمل والتسليم
        </h6>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <div class="form-floating">
                <input type="number" class="form-control" name="setup_time_minutes" 
                       id="setup-time" placeholder="وقت التجهيز" min="0" value="0">
                <label for="setup-time">وقت التجهيز (دقائق)</label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <input type="number" class="form-control" name="turnaround_time_hours" 
                       id="turnaround-time" placeholder="وقت التسليم" min="1" value="24" required>
                <label for="turnaround-time">وقت التسليم (ساعات) *</label>
            </div>
        </div>
    </div>

    <!-- الحقول الأساسية المشتركة -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="form-floating">
                <input type="number" class="form-control" name="base_price" 
                       id="base-price" placeholder="السعر الأساسي" min="0" required>
                <label for="base-price">السعر الأساسي ({{ currency_symbol }}) *</label>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-floating">
                <input type="number" class="form-control" name="setup_cost" 
                       id="setup-cost" placeholder="تكلفة التجهيز" min="0" value="0">
                <label for="setup-cost">تكلفة التجهيز ({{ currency_symbol }})</label>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-floating">
                <input type="number" class="form-control" name="min_quantity" 
                       id="min-quantity" placeholder="الحد الأدنى" min="1" value="1" required>
                <label for="min-quantity">الحد الأدنى للكمية *</label>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-8">
            <div class="form-floating">
                <textarea class="form-control" name="description" id="description" 
                          placeholder="وصف الخدمة" style="height: 80px;"></textarea>
                <label for="description">وصف الخدمة</label>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-floating">
                <textarea class="form-control" name="notes" id="notes" 
                          placeholder="ملاحظات" style="height: 80px;"></textarea>
                <label for="notes">ملاحظات</label>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-12">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="is_active" 
                       id="is-active" checked>
                <label class="form-check-label" for="is-active">
                    الخدمة نشطة
                </label>
            </div>
        </div>
    </div>

    <!-- معلومات إضافية -->
    <div class="alert alert-light border">
        <h6 class="alert-heading">
            <i class="fas fa-info-circle text-primary me-2"></i>
            معلومات مهمة عن خدمات الطباعة
        </h6>
        <ul class="mb-0 small">
            <li><strong>بالقطعة:</strong> سعر ثابت لكل قطعة</li>
            <li><strong>بالألف:</strong> سعر لكل 1000 قطعة</li>
            <li><strong>بالساعة:</strong> سعر العمل بالساعة</li>
            <li><strong>بالمتر:</strong> سعر لكل متر طولي</li>
        </ul>
    </div>

    <!-- حاسبة سريعة -->
    <div class="card mt-4">
        <div class="card-header bg-light">
            <h6 class="mb-0">
                <i class="fas fa-calculator me-2"></i>
                حاسبة سريعة للتكلفة
            </h6>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">الكمية المطلوبة</label>
                    <input type="number" class="form-control" id="calc-quantity" 
                           placeholder="الكمية" min="1" value="100">
                </div>
                <div class="col-md-4">
                    <label class="form-label">طريقة الحساب</label>
                    <select class="form-select" id="calc-method">
                        <option value="per_piece">بالقطعة</option>
                        <option value="per_thousand">بالألف</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">التكلفة المتوقعة</label>
                    <input type="text" class="form-control bg-light" id="calc-result" 
                           placeholder="سيتم الحساب تلقائياً" readonly>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// تحديث السعر الأساسي من سعر الوحدة
document.getElementById('price-per-unit').addEventListener('input', function() {
    const basePriceField = document.getElementById('base-price');
    if (!basePriceField.value) {
        basePriceField.value = this.value;
    }
    calculateQuickCost();
});

// حاسبة سريعة
function calculateQuickCost() {
    const quantity = parseInt(document.getElementById('calc-quantity').value) || 0;
    const method = document.getElementById('calc-method').value;
    const pricePerUnit = parseFloat(document.getElementById('price-per-unit').value) || 0;
    const setupCost = parseFloat(document.getElementById('setup-cost').value) || 0;
    
    if (quantity > 0 && pricePerUnit > 0) {
        let totalCost = setupCost;
        
        switch (method) {
            case 'per_piece':
                totalCost += quantity * pricePerUnit;
                break;
            case 'per_thousand':
                totalCost += Math.ceil(quantity / 1000) * pricePerUnit;
                break;
            case 'per_hour':
                // افتراض ساعة واحدة لكل 100 قطعة
                const hours = Math.ceil(quantity / 100);
                totalCost += hours * pricePerUnit;
                break;
            case 'per_meter':
                // افتراض متر واحد لكل 10 قطع
                const meters = Math.ceil(quantity / 10);
                totalCost += meters * pricePerUnit;
                break;
        }
        
        const costPerPiece = totalCost / quantity;
        document.getElementById('calc-result').value = 
            `${totalCost.toFixed(2)} {{ currency_symbol }} (${costPerPiece.toFixed(3)} {{ currency_symbol }}/قطعة)`;
    }
}

// ربط الأحداث
document.getElementById('calc-quantity').addEventListener('input', calculateQuickCost);
document.getElementById('calc-method').addEventListener('change', calculateQuickCost);
document.getElementById('setup-cost').addEventListener('input', calculateQuickCost);

// تحديث طريقة الحساب في الحاسبة عند تغيير النموذج
document.getElementById('calculation-method').addEventListener('change', function() {
    document.getElementById('calc-method').value = this.value;
    calculateQuickCost();
});

// تحديث اسم الخدمة تلقائياً
document.getElementById('finishing-type').addEventListener('change', function() {
    const nameField = document.getElementById('service-name');
    if (!nameField.value) {
        const selectedOption = this.options[this.selectedIndex];
        if (selectedOption.value) {
            nameField.value = `خدمة ${selectedOption.text}`;
        }
    }
});
</script>
