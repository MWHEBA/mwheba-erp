{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load custom_filters %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components.css' %}">
<link rel="stylesheet" href="{% static 'css/tables.css' %}">
<link rel="stylesheet" href="{% static 'css/cards.css' %}">
<style>
  /* تصميم متسق مع هوية النظام */

  .movement-row {
    transition: all var(--transition-speed) var(--transition-function);
  }
  
  .movement-row:hover {
    background-color: var(--gray-50);
  }
  
  .movement-amount {
    font-weight: var(--font-weight-medium);
  }
  
  .movement-amount.debit {
    color: var(--success-color);
  }
  
  .movement-amount.credit {
    color: var(--danger-color);
  }
  
  .filter-section {
    background-color: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: var(--spacing-6);
    margin-bottom: var(--spacing-6);
  }
  

  .section-container .card {
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-sm);
    background: var(--bg-card);
  }

  .card-header {
    background-color: var(--gray-50);
    border-bottom: 1px solid var(--border-color);
    padding: var(--spacing-4);
  }

  .card-header h5 {
    color: var(--text-dark);
    font-weight: var(--font-weight-bold);
    margin-bottom: 0;
  }

  .empty-state {
    padding: var(--spacing-12) var(--spacing-6);
    text-align: center;
  }

  .empty-state-icon {
    font-size: 4rem;
    color: var(--gray-400);
    margin-bottom: var(--spacing-4);
  }

  .empty-state-title {
    color: var(--text-dark);
    font-size: 1.25rem;
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--spacing-2);
  }

  .empty-state-description {
    color: var(--text-medium);
    margin-bottom: var(--spacing-4);
  }

  .badge {
    font-size: 0.75rem;
    font-weight: var(--font-weight-medium);
  }

  .btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }

  /* Emphasis styles for current balance */
  .current-balance-box {
    background: var(--primary-soft-2);
    border: 1px solid var(--primary-focus);
    border-radius: var(--border-radius);
    padding: var(--spacing-3);
  }
  .current-balance-value {
    font-size: 1.5rem;
    font-weight: var(--font-weight-bold);
    color: var(--primary-color);
    line-height: 1.1;
  }
  .current-balance-label {
    color: var(--text-medium);
    font-size: 0.85rem;
  }

  /* Center debit/credit vertically */
  .summary-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 60px;
  }

  /* تصميم المودال */
  .journal-entry-modal .modal-header {
    background-color: var(--bg-card);
    border-bottom: 1px solid var(--border-color);
  }

  .journal-entry-modal .modal-title {
    color: var(--text-dark);
    font-weight: var(--font-weight-bold);
  }

  .journal-entry-details {
    background-color: var(--gray-50);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: var(--spacing-4);
    margin-bottom: var(--spacing-4);
  }

  .journal-entry-line {
    border-bottom: 1px solid var(--border-color);
    padding: var(--spacing-3) 0;
  }

  .journal-entry-line:last-child {
    border-bottom: none;
  }

  .account-name {
    font-weight: var(--font-weight-medium);
    color: var(--text-dark);
  }

  .amount-debit {
    color: var(--success-color);
    font-weight: var(--font-weight-medium);
  }

  .amount-credit {
    color: var(--danger-color);
    font-weight: var(--font-weight-medium);
  }

  .clickable-row {
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .clickable-row:hover {
    background-color: var(--gray-50) !important;
  }

  /* تصميم الـ badges بدون خلفية ملونة */
  .status-badge {
    background-color: transparent !important;
    padding: 0.25rem 0.5rem;
    border-radius: var(--border-radius);
    font-size: 0.75rem;
    font-weight: var(--font-weight-medium);
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- عنوان الصفحة (مضمن مباشرة) -->
  <div class="mb-4">
    <!-- Breadcrumbs -->
    {% if breadcrumb_items %}
    <div class="mb-2">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          {% for item in breadcrumb_items %}
            {% if forloop.last or item.active %}
              <li class="breadcrumb-item active" aria-current="page">
                {% if item.icon %}<i class="{{ item.icon }} me-1"></i>{% endif %}
                {{ item.title }}
              </li>
            {% else %}
              <li class="breadcrumb-item">
                <a href="{{ item.url }}">
                  {% if item.icon %}<i class="{{ item.icon }} me-1"></i>{% endif %}
                  {{ item.title }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
        </ol>
      </nav>
    </div>
    {% endif %}
    
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded shadow-sm">
      <div class="d-flex align-items-center">
        <div class="me-3">
          {% if account.is_cash_account %}
            <i class="fas fa-money-bill-wave fa-2x text-success"></i>
          {% elif account.is_bank_account %}
            <i class="fas fa-university fa-2x text-primary"></i>
          {% else %}
            <i class="fas fa-landmark fa-2x text-secondary"></i>
          {% endif %}
        </div>
        <div>
          <h1 class="h3 mb-1">{{ page_title }}</h1>
          <p class="text-muted mb-0">
            {% trans "الرصيد الحالي:" %} {{ current_balance|custom_number_format }} {% trans "جنيه" %} | 
            {% if account.is_cash_account %}
              {% trans "حساب نقدي" %}
            {% elif account.is_bank_account %}
              {% trans "حساب بنكي" %}
            {% else %}
              {% trans "حساب آخر" %}
            {% endif %}
          </p>
        </div>
      </div>
      <div>
        <a href="{% url 'financial:journal_entries_create' %}" class="btn btn-primary">
          <i class="fas fa-plus me-2"></i>{% trans "إضافة قيد جديد" %}
        </a>
        <a href="{% url 'financial:account_detail' account.id %}" class="btn btn-outline-secondary ms-2">
          <i class="fas fa-info-circle me-2"></i>{% trans "تفاصيل الحساب" %}
        </a>
      </div>
    </div>
  </div>

  <!-- ملخص الأرصدة البسيط -->
  <div class="row mb-3">
    <div class="col-12">
      <div class="alert alert-light border" style="background-color: #f8f9fa; border-color: #dee2e6;">
        <div class="row text-center">
          <div class="col-md-4 summary-col">
            <h6 class="mb-1 text-success">{{ total_debit|custom_number_format }}</h6>
            <small class="text-muted">إجمالي المدين</small>
          </div>
          <div class="col-md-4 summary-col">
            <h6 class="mb-1 text-danger">{{ total_credit|custom_number_format }}</h6>
            <small class="text-muted">إجمالي الدائن</small>
          </div>
          <div class="col-md-4">
            <div class="current-balance-box">
              <div class="current-balance-value">{{ current_balance|custom_number_format }}</div>
              <div class="current-balance-label">الرصيد الحالي</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- فلاتر البحث -->
  <div class="filter-section">
    <form method="get" class="row g-3">
      <div class="col-md-3">
        <label for="date_from" class="form-label">من تاريخ</label>
        <input type="date" class="form-control" id="date_from" name="date_from" value="{% if date_from and date_from != 'None' %}{{ date_from }}{% endif %}">
      </div>
      <div class="col-md-3">
        <label for="date_to" class="form-label">إلى تاريخ</label>
        <input type="date" class="form-control" id="date_to" name="date_to" value="{% if date_to and date_to != 'None' %}{{ date_to }}{% endif %}">
      </div>
      <div class="col-md-4">
        <label for="search" class="form-label">بحث</label>
        <input type="text" class="form-control" id="search" name="search" value="{{ search }}" placeholder="البحث في الوصف أو المرجع...">
      </div>
      <div class="col-md-2">
        <label class="form-label">&nbsp;</label>
        <div class="d-grid">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-search me-1"></i>بحث
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- قائمة الحركات -->
  <div class="section-container">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0"><i class="fas fa-list me-2"></i>{% trans "حركات الحساب" %}</h5>
        <div class="actions-container">
          <span class="badge" style="background-color: var(--info-color); color: var(--white);">{{ movements.paginator.count }} حركة</span>
        </div>
      </div>
      <div class="card-body">
        {% if movements %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">التاريخ</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">المرجع</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">الوصف</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">مدين</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">دائن</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">الرصيد</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">الحالة</th>
                  <th style="color: var(--text-dark); font-weight: var(--font-weight-bold);">الإجراءات</th>
                </tr>
              </thead>
              <tbody>
                {% for movement in movements %}
                <tr class="movement-row clickable-row" data-journal-entry-id="{{ movement.journal_entry.id }}">
                  <td>{{ movement.journal_entry.date|date:"d-m-Y" }}</td>
                  <td>
                    <span class="badge" style="background-color: var(--gray-600); color: var(--white);">{{ movement.journal_entry.reference|default:movement.journal_entry.number }}</span>
                  </td>
                  <td>
                    <div>
                      <strong>{{ movement.journal_entry.description }}</strong>
                      {% if movement.description and movement.description != movement.journal_entry.description %}
                        <br><small class="text-muted">{{ movement.description }}</small>
                      {% endif %}
                    </div>
                  </td>
                  <td>
                    {% if movement.debit %}
                      <span class="movement-amount debit">
                        {{ movement.debit|custom_number_format }}
                      </span>
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if movement.credit %}
                      <span class="movement-amount credit">
                        {{ movement.credit|custom_number_format }}
                      </span>
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>
                  <td>
                    <span class="text-primary fw-bold">
                      {{ movement.running_balance|custom_number_format }}
                    </span>
                  </td>
                  <td>
                    {% if movement.journal_entry.status == 'posted' %}
                      <span class="badge" style="background-color: var(--success-color); color: var(--white);">مرحل</span>
                    {% elif movement.journal_entry.status == 'draft' %}
                      <span class="badge" style="background-color: var(--warning-color); color: var(--white);">مسودة</span>
                    {% else %}
                      <span class="badge" style="background-color: var(--gray-600); color: var(--white);">{{ movement.journal_entry.get_status_display }}</span>
                    {% endif %}
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <a href="{% url 'financial:journal_entries_detail' movement.journal_entry.pk %}" 
                         class="btn btn-outline-primary btn-sm" title="عرض القيد">
                        <i class="fas fa-eye"></i>
                      </a>
                      {% if movement.journal_entry.status == 'draft' %}
                        <a href="{% url 'financial:journal_entries_edit' movement.journal_entry.pk %}" 
                           class="btn btn-outline-secondary btn-sm" title="تعديل">
                          <i class="fas fa-edit"></i>
                        </a>
                      {% endif %}
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          {% if movements.has_other_pages %}
            <nav aria-label="Page navigation">
              <ul class="pagination justify-content-center">
                {% if movements.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ movements.previous_page_number }}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if search %}&search={{ search }}{% endif %}">السابق</a>
                  </li>
                {% endif %}
                
                {% for num in movements.paginator.page_range %}
                  {% if movements.number == num %}
                    <li class="page-item active">
                      <span class="page-link">{{ num }}</span>
                    </li>
                  {% elif num > movements.number|add:'-3' and num < movements.number|add:'3' %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ num }}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if search %}&search={{ search }}{% endif %}">{{ num }}</a>
                    </li>
                  {% endif %}
                {% endfor %}
                
                {% if movements.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ movements.next_page_number }}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}{% if search %}&search={{ search }}{% endif %}">التالي</a>
                  </li>
                {% endif %}
              </ul>
            </nav>
          {% endif %}
        {% else %}
          <div class="text-center py-5">
            <div class="empty-state">
              <div class="empty-state-icon"><i class="fas fa-list-alt"></i></div>
              <h4 class="empty-state-title">لا توجد حركات</h4>
              <p class="empty-state-description">لم يتم العثور على حركات لهذا الحساب في الفترة المحددة.</p>
              <a href="{% url 'financial:journal_entries_create' %}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>إضافة قيد جديد
              </a>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- مودال ملخص القيد -->
<div class="modal fade journal-entry-modal" id="journalEntryModal" tabindex="-1" aria-labelledby="journalEntryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="journalEntryModalLabel">
          <i class="fas fa-file-invoice me-2"></i>ملخص القيد المحاسبي
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
      </div>
      <div class="modal-body" id="journalEntryContent">
        <div class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
          </div>
          <p class="mt-2 text-muted">جاري تحميل تفاصيل القيد...</p>
        </div>
      </div>
      <div class="modal-footer">
        <div class="me-auto">
          <!-- الأزرار الإضافية للدفعة والفاتورة والعميل/المورد -->
          <a href="#" id="viewPaymentBtn" class="btn btn-outline-success btn-sm me-2" target="_blank" style="display: none;">
            <i class="fas fa-money-bill-wave me-1"></i>عرض الدفعة
          </a>
          <a href="#" id="viewInvoiceBtn" class="btn btn-outline-info btn-sm me-2" target="_blank" style="display: none;">
            <i class="fas fa-file-invoice me-1"></i>عرض الفاتورة
          </a>
          <a href="#" id="viewClientBtn" class="btn btn-outline-warning btn-sm me-2" target="_blank" style="display: none;">
            <i class="fas fa-user me-1"></i><span id="clientBtnText">عرض العميل</span>
          </a>
        </div>
        <div>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i>إغلاق
          </button>
          <a href="#" id="viewFullJournalEntry" class="btn btn-primary" target="_blank">
            <i class="fas fa-external-link-alt me-1"></i>عرض كامل
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function() {
    // تنسيق حقول التاريخ
    $('input[type="date"]').addClass('form-control');
    
    // تحديد التاريخ الافتراضي للبحث
    if (!$('#date_from').val() || $('#date_from').val() === 'None') {
      var lastMonth = new Date();
      lastMonth.setMonth(lastMonth.getMonth() - 1);
      $('#date_from').val(lastMonth.toISOString().split('T')[0]);
    }
    
    // التأكد من أن حقول التاريخ لا تحتوي على قيم غير صالحة
    $('input[type="date"]').each(function() {
      if ($(this).val() === 'None' || $(this).val() === 'null') {
        $(this).val('');
      }
    });
    
    // إضافة event listener للصفوف القابلة للنقر
    $(document).on('click', '.clickable-row', function(e) {
      // تجاهل النقر إذا كان على رابط أو زر
      if ($(e.target).closest('a, button').length > 0) {
        return;
      }
      
      const journalEntryId = $(this).data('journal-entry-id');
      if (journalEntryId) {
        showJournalEntryModal(journalEntryId);
      }
    });
  });

  // دالة عرض مودال القيد المحاسبي
  function showJournalEntryModal(journalEntryId) {
    // منع انتشار الحدث للروابط الأخرى
    event.stopPropagation();
    
    // إظهار المودال
    const modal = new bootstrap.Modal(document.getElementById('journalEntryModal'));
    modal.show();
    
    // تحديث رابط العرض الكامل
    document.getElementById('viewFullJournalEntry').href = 
      `/financial/journal-entries/${journalEntryId}/`;
    
    // إخفاء جميع الأزرار الإضافية في البداية
    document.getElementById('viewPaymentBtn').style.display = 'none';
    document.getElementById('viewInvoiceBtn').style.display = 'none';
    document.getElementById('viewClientBtn').style.display = 'none';
    
    // جلب تفاصيل القيد
    fetch(`/financial/api/journal-entry/${journalEntryId}/summary/`)
      .then(response => {
        if (!response.ok) {
          if (response.status === 404) {
            throw new Error('القيد المحاسبي غير موجود');
          } else if (response.status === 403) {
            throw new Error('ليس لديك صلاحية للوصول إلى هذا القيد');
          } else {
            throw new Error(`خطأ في الخادم: ${response.status}`);
          }
        }
        return response.json();
      })
      .then(data => {
        if (data.error) {
          throw new Error(data.error);
        }
        displayJournalEntrySummary(data);
        updateActionButtons(data);
      })
      .catch(error => {
        console.error('خطأ:', error);
        document.getElementById('journalEntryContent').innerHTML = `
          <div class="alert alert-danger text-center">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>خطأ في تحميل القيد:</strong><br>
            ${error.message}
            <div class="mt-3">
              <button type="button" class="btn btn-outline-primary btn-sm" onclick="showJournalEntryModal(${journalEntryId})">
                <i class="fas fa-redo me-1"></i>إعادة المحاولة
              </button>
            </div>
          </div>
        `;
      });
  }

  // دالة عرض ملخص القيد
  function displayJournalEntrySummary(data) {
    const content = document.getElementById('journalEntryContent');
    
    let html = `
      <div class="journal-entry-details">
        <div class="row">
          <div class="col-md-6">
            <strong>رقم القيد:</strong> ${data.number || data.reference}
          </div>
          <div class="col-md-6">
            <strong>التاريخ:</strong> ${data.date}
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-12">
            <strong>الوصف:</strong> ${data.description}
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-md-6">
            <strong>الحالة:</strong> 
            <span class="badge ${getStatusBadgeClass(data.status)}">
              ${getStatusDisplayName(data.status)}
            </span>
          </div>
          <div class="col-md-6">
            <strong>المستخدم:</strong> ${data.created_by || 'غير محدد'}
          </div>
        </div>`;
    
    
    html += `
      </div>
      
      <h6 class="mb-3"><i class="fas fa-list me-2"></i>بنود القيد:</h6>
      <div class="table-responsive">
        <table class="table table-sm">
          <thead class="table-light">
            <tr>
              <th>الحساب</th>
              <th class="text-center">مدين</th>
              <th class="text-center">دائن</th>
            </tr>
          </thead>
          <tbody>
    `;
    
    let totalDebit = 0;
    let totalCredit = 0;
    
    data.lines.forEach(line => {
      totalDebit += parseFloat(line.debit || 0);
      totalCredit += parseFloat(line.credit || 0);
      
      html += `
        <tr class="journal-entry-line">
          <td>
            <div class="account-name">${line.account_name}</div>
            <small class="text-muted">${line.account_code}</small>
          </td>
          <td class="text-center">
            ${line.debit ? `<span class="amount-debit">${formatNumber(line.debit)}</span>` : '-'}
          </td>
          <td class="text-center">
            ${line.credit ? `<span class="amount-credit">${formatNumber(line.credit)}</span>` : '-'}
          </td>
        </tr>
      `;
    });
    
    html += `
          </tbody>
          <tfoot class="table-secondary">
            <tr>
              <th>الإجمالي</th>
              <th class="text-center amount-debit">${formatNumber(totalDebit)}</th>
              <th class="text-center amount-credit">${formatNumber(totalCredit)}</th>
            </tr>
          </tfoot>
        </table>
      </div>
    `;
    
    content.innerHTML = html;
  }

  // دوال مساعدة
  function getStatusBadgeClass(status) {
    switch(status) {
      case 'posted': return 'status-badge text-success border border-success';
      case 'draft': return 'status-badge text-warning border border-warning';
      case 'cancelled': return 'status-badge text-danger border border-danger';
      default: return 'status-badge text-secondary border border-secondary';
    }
  }

  function getStatusDisplayName(status) {
    switch(status) {
      case 'posted': return 'مرحل';
      case 'draft': return 'مسودة';
      case 'cancelled': return 'ملغي';
      default: return status;
    }
  }

  function formatNumber(num) {
    return parseFloat(num).toLocaleString('en-US', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

  // دالة تحديث أزرار الإجراءات حسب توفر البيانات
  function updateActionButtons(data) {
    
    const paymentBtn = document.getElementById('viewPaymentBtn');
    const invoiceBtn = document.getElementById('viewInvoiceBtn');
    const clientBtn = document.getElementById('viewClientBtn');
    const clientBtnText = document.getElementById('clientBtnText');
    
    
    // إخفاء جميع الأزرار في البداية
    paymentBtn.style.display = 'none';
    invoiceBtn.style.display = 'none';
    clientBtn.style.display = 'none';
    
    // التحقق من وجود معلومات المصدر
    if (data.source) {
      console.log('Available source data:', Object.keys(data.source)); // للتصحيح
      console.log('Source data values:', data.source); // للتصحيح
      
      // زر عرض الدفعة
      if (data.source.payment_url) {
        paymentBtn.href = data.source.payment_url;
        paymentBtn.style.display = 'inline-block';
        paymentBtn.style.visibility = 'visible';
      }
      
      // زر عرض الفاتورة
      if (data.source.invoice_url) {
        console.log('Setting invoice button:', data.source.invoice_url); // للتصحيح
        invoiceBtn.href = data.source.invoice_url;
        invoiceBtn.style.display = 'inline-block';
      }
      
      // زر عرض العميل أو المورد
      if (data.source.customer_url) {
        console.log('Setting customer button:', data.source.customer_url); // للتصحيح
        clientBtn.href = data.source.customer_url;
        clientBtnText.textContent = 'عرض العميل';
        clientBtn.style.display = 'inline-block';
      } else if (data.source.supplier_url) {
        console.log('Setting supplier button:', data.source.supplier_url); // للتصحيح
        clientBtn.href = data.source.supplier_url;
        clientBtnText.textContent = 'عرض المورد';
        clientBtn.style.display = 'inline-block';
      }
    }
    
  }
</script>
{% endblock %}
