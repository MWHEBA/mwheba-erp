{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load utils_extras %}
{% load dict_tags %}
{% load app_tags %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<!-- جميع الستايلات موجودة في shared-components.css و components.css -->
{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- Page Header المركزي -->
  {% include "shared/page_header.html" %}

  <!-- تصفية وبحث -->
  <div class="section-container">
    <h5 class="section-title"><i class="fas fa-filter me-2"></i>{% trans "تصفية وبحث" %}</h5>
    <div class="filter-section mb-4">
      <form method="GET" action="" class="row g-3">
        <div class="col-md-3">
          <label for="search" class="form-label">{% trans "البحث" %}</label>
          <input type="text" class="form-control" id="search" name="search" 
                 placeholder="{% trans 'ابحث بالمرجع أو الوصف' %}" value="{{ request.GET.search }}">
        </div>
        <div class="col-md-2">
          <label for="status" class="form-label">{% trans "حالة القيد" %}</label>
          <select class="form-select" id="status" name="status">
            <option value="">{% trans "الكل" %}</option>
            <option value="draft" {% if request.GET.status == 'draft' %}selected{% endif %}>{% trans "مسودة" %}</option>
            <option value="posted" {% if request.GET.status == 'posted' %}selected{% endif %}>{% trans "مرحل" %}</option>
            <option value="cancelled" {% if request.GET.status == 'cancelled' %}selected{% endif %}>{% trans "ملغي" %}</option>
          </select>
        </div>
        <div class="col-md-2">
          <label for="date_from" class="form-label">{% trans "من تاريخ" %}</label>
          <input type="text" class="form-control" id="date_from" name="date_from" data-date-picker placeholder="من تاريخ" value="{{ request.GET.date_from }}">
        </div>
        <div class="col-md-2">
          <label for="date_to" class="form-label">{% trans "إلى تاريخ" %}</label>
          <input type="text" class="form-control" id="date_to" name="date_to" data-date-picker placeholder="إلى تاريخ" value="{{ request.GET.date_to }}">
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">
            <i class="fas fa-search me-2"></i>{% trans "بحث" %}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- قائمة القيود المحاسبية -->
  <div class="section-container">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0"><i class="fas fa-list me-2"></i>{% trans "قائمة القيود المحاسبية" %}</h5>
        <div class="actions-container">
          <!-- تم إزالة زر إضافة قيد -->
        </div>
      </div>
      <div class="card-body">
        {% if journal_entries %}
        <!-- استخدام الجدول الموحد -->
          {% with table_id="journal-entries-table" %}
            {% with headers=headers %}
              {% with data=journal_entries %}
                {% with action_buttons=action_buttons %}
                  {% with empty_message="لا توجد قيود محاسبية متاحة" %}
                    {% with clickable_rows=True row_click_url="/financial/journal-entries/0/" %}
                      {% with show_export=True export_filename="journal_entries" %}
                        {% include "components/data_table.html" %}
                      {% endwith %}
                    {% endwith %}
                  {% endwith %}
                {% endwith %}
              {% endwith %}
            {% endwith %}
          {% endwith %}
        
        {% else %}
          {% include 'partials/empty_state.html' with message="لا توجد قيود محاسبية متاحة" icon="book" %}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- الجدول الموحد يتولى جميع الوظائف -->
{% endblock %}

