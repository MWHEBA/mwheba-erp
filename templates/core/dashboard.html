{% extends 'base.html' %}
{% load humanize %}
{% load static %}
{% load utils_extras %}
{% load custom_filters %}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ù†Ø¸Ø§Ù… Ù…ÙˆÙ‡Ø¨Ø© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ø²Ù†{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard Cards - Flat Design */
    .dashboard-card {
        background-color: var(--bg-card);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--border-color);
    }
    
    .dashboard-card .card-header {
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.75rem;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .dashboard-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0;
    }

    /* Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ù…ÙˆØ­Ø¯ Ù…Ù† cards.css */
    /* ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø®ØµØµ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… .stats-card Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ */
    
    /* Tables */
    .recent-table th, .recent-table td {
        padding: 0.75rem 1rem;
        vertical-align: middle;
    }
    
    .recent-table thead th {
        background-color: var(--bg-light);
        font-weight: 600;
        font-size: 0.85rem;
        color: var(--text-dark);
        border-bottom: 2px solid var(--border-color);
    }
    
    .recent-table tbody tr {
        transition: background-color var(--transition-speed);
    }
    
    .recent-table tbody tr:hover {
        background-color: var(--bg-light);
    }
    
    /* Inventory Alerts */
    .inventory-alert {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        background-color: var(--bg-soft-warning);
        border-radius: var(--border-radius);
        margin-bottom: 0.5rem;
        border-right: 3px solid var(--warning-color);
    }
    
    .inventory-alert-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: var(--border-radius);
        background-color: var(--warning-color);
        color: var(--white);
        margin-left: 0.75rem;
    }
    
    .inventory-alert-content {
        flex: 1;
    }
    
    .inventory-alert-title {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
        color: var(--text-dark);
    }
    
    .inventory-alert-text {
        font-size: 0.8rem;
        color: var(--text-medium);
        margin-bottom: 0;
    }
    
    /* Welcome Banner - Flat Design */
    .welcome-banner {
        position: relative;
        border-radius: var(--border-radius);
        overflow: hidden;
        min-height: 160px;
        display: flex;
        align-items: center;
        background-color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding: 2rem;
        border: 1px solid var(--primary-dark);
    }
    
    .welcome-content {
        position: relative;
        z-index: 2;
        width: 100%;
    }
    
    .welcome-title {
        color: var(--white);
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .welcome-subtitle {
        color: var(--white);
        opacity: 0.9;
        font-size: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .welcome-actions .btn {
        padding: 0.5rem 1.5rem;
        border-radius: var(--border-radius);
        font-weight: 500;
        transition: all var(--transition-speed);
    }
    
    .welcome-img {
        position: absolute;
        left: 0;
        bottom: -50%;
        height: 200%;
        z-index: 1;
        opacity: 0.03;
    }
    
    /* Charts */
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }
    
    .chart-legend {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
        gap: 1rem;
    }
    
    .chart-legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .chart-legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
    }
    
    .chart-legend-label {
        font-size: 0.8rem;
        color: var(--text-dark);
    }
    
    .chart-tabs {
        display: flex;
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 1rem;
        gap: 0.5rem;
    }
    
    .chart-tab {
        padding: 0.5rem 1rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        font-weight: 500;
        font-size: 0.9rem;
        color: var(--text-medium);
        transition: all var(--transition-speed);
        margin-bottom: -2px;
    }
    
    .chart-tab:hover {
        color: var(--primary-color);
    }
    
    .chart-tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
    }
    
    /* Financial Summary Cards */
    .financial-card {
        padding: 1rem;
        background-color: var(--bg-light);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        transition: all var(--transition-speed);
    }
    
    .financial-card:hover {
        background-color: var(--bg-card);
        box-shadow: var(--card-shadow);
    }
    
    /* Quick Actions */
    .quick-action-card {
        text-align: center;
        padding: 1.5rem;
        background-color: var(--bg-card);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        transition: all var(--transition-speed);
        cursor: pointer;
    }
    
    .quick-action-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow);
        border-color: var(--primary-color);
    }
    
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 768px) {
        .welcome-banner {
            min-height: 120px;
            padding: 1.5rem;
        }
        
        .welcome-title {
            font-size: 1.25rem;
        }
        
        .welcome-subtitle {
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .welcome-actions .btn {
            padding: 0.4rem 1rem;
            font-size: 0.85rem;
        }
        
        .dashboard-card {
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .dashboard-card .card-title {
            font-size: 1rem;
        }
        
        .chart-container {
            height: 250px;
        }
        
        .chart-tabs {
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .chart-tab {
            padding: 0.4rem 0.75rem;
            font-size: 0.85rem;
        }
        
        .recent-table th,
        .recent-table td {
            padding: 0.5rem;
            font-size: 0.85rem;
        }
        
        .quick-action-card {
            padding: 1rem;
        }
        
        .quick-action-icon {
            width: 48px;
            height: 48px;
            font-size: 1.25rem;
        }
        
        .inventory-alert {
            padding: 0.5rem;
        }
        
        .inventory-alert-icon {
            width: 32px;
            height: 32px;
            margin-left: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Ø¨Ø§Ù†Ø± Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div class="welcome-banner">
        <img src="{% static light_logo %}" alt="{{ site_name }}" class="welcome-img">
        <div class="welcome-content">
            <h1 class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ {{ request.user.first_name|default:request.user.username }}</h1>
            <p class="welcome-subtitle">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Ø¸Ø§Ù… Ù…ÙˆÙ‡Ø¨Ø© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ø²Ù†</p>
            <div class="welcome-actions">
                <a href="{% url 'sale:sale_create' %}" class="btn btn-light me-2">
                    <i class="fas fa-plus-circle me-1"></i> ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©
                </a>
                <a href="{% url 'purchase:purchase_create' %}" class="btn btn-outline-light">
                    <i class="fas fa-cart-plus me-1"></i> Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
                </a>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
        <div class="col-lg-12 mb-4">
            <div class="row">
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="stats-card stats-card-primary">
                        <div class="stats-card-header"></div>
                        <div class="stats-card-body">
                            <div class="stats-card-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stats-card-title">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                            <div class="stats-card-value">{{ sales_today.total|default:0|currency }}</div>
                            <div class="stats-card-unit">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: {{ sales_today.count|default:0 }}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="stats-card stats-card-warning">
                        <div class="stats-card-header"></div>
                        <div class="stats-card-body">
                            <div class="stats-card-icon">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="stats-card-title">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                            <div class="stats-card-value">{{ purchases_today.total|default:0|currency }}</div>
                            <div class="stats-card-unit">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: {{ purchases_today.count|default:0 }}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
{{ ... }}
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="stats-card stats-card-success">
                        <div class="stats-card-header"></div>
                        <div class="stats-card-body">
                            <div class="stats-card-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stats-card-title">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                            <div class="stats-card-value">{{ customers_count|default:0 }}</div>
                            <div class="stats-card-unit">Ø¹Ù…ÙŠÙ„ Ù†Ø´Ø·</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="stats-card stats-card-info">
                        <div class="stats-card-header"></div>
                        <div class="stats-card-body">
                            <div class="stats-card-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stats-card-title">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
                            <div class="stats-card-value">{{ products_count|default:0 }}</div>
                            <div class="stats-card-unit">Ù…Ù†ØªØ¬ Ù†Ø´Ø·</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Ù‚Ø³Ù… Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card h-100">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-receipt me-2 text-primary"></i>
                        Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                    </h5>
                    <a href="{% url 'sale:sale_list' %}" class="btn btn-sm btn-primary">ÙƒÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a>
                </div>
                <div class="table-responsive">
                    <table class="table recent-table mb-0">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if recent_sales %}
                                {% for sale in recent_sales %}
                                <tr>
                                    <td><a href="{% url 'sale:sale_detail' sale.id %}" class="fw-medium">{{ sale.number }}</a></td>
                                    <td>{{ sale.customer.name }}</td>
                                    <td>{{ sale.date|date:"d-m-Y" }}</td>
                                    <td class="fw-bold">{{ sale.total|currency }}</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <div class="d-flex flex-column align-items-center">
                                            <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card h-100">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-truck-loading me-2 text-warning"></i>
                        Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
                    </h5>
                    <a href="{% url 'purchase:purchase_list' %}" class="btn btn-sm btn-warning">ÙƒÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</a>
                </div>
                <div class="table-responsive">
                    <table class="table recent-table mb-0">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                <th>Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if recent_purchases %}
                                {% for purchase in recent_purchases %}
                                <tr>
                                    <td><a href="{% url 'purchase:purchase_detail' purchase.id %}" class="fw-medium">{{ purchase.number }}</a></td>
                                    <td>{{ purchase.supplier.name }}</td>
                                    <td>{{ purchase.date|date:"d-m-Y" }}</td>
                                    <td class="fw-bold">{{ purchase.total|currency }}</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <div class="d-flex flex-column align-items-center">
                                            <i class="fas fa-truck fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card h-100">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                        Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    </h5>
                    <a href="{% url 'product:product_list' %}" class="btn btn-sm btn-warning">ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
                </div>
                <div>
                    {% if low_stock_products %}
                        {% for product in low_stock_products %}
                            <div class="inventory-alert">
                                <div class="inventory-alert-icon">
                                    <i class="fas fa-exclamation"></i>
                                </div>
                                <div class="inventory-alert-content">
                                    <div class="inventory-alert-title">{{ product.name }}</div>
                                    <div class="inventory-alert-text">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: {{ product.stocks.first.quantity }}</div>
                                </div>
                                <a href="{% url 'purchase:purchase_create' %}?product={{ product.id }}" class="btn btn-sm btn-outline-primary">Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="d-flex flex-column align-items-center py-4">
                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                            <p class="text-muted">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø© Ø¨ÙƒÙ…ÙŠØ§Øª ÙƒØ§ÙÙŠØ©</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card h-100">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-chart-pie me-2 text-info"></i>
                        <span id="financialSummaryTitle">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                    </h5>
                    <a href="{% url 'financial:financial_analytics' %}" class="btn btn-sm btn-info">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                </div>
                <div class="row g-3 mt-1">
                    <div class="col-md-6">
                        <div class="financial-card">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                                <i class="fas fa-arrow-up text-success"></i>
                            </div>
                            <div class="h4 mb-0" id="salesTotal">{{ sales_today.total|default:0|currency }}</div>
                            <div class="text-muted small" id="salesPeriod">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="financial-card">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                                <i class="fas fa-arrow-down text-danger"></i>
                            </div>
                            <div class="h4 mb-0" id="purchasesTotal">{{ purchases_today.total|default:0|currency }}</div>
                            <div class="text-muted small" id="purchasesPeriod">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="financial-card">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div class="text-muted">Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                                <i class="fas fa-users text-primary"></i>
                            </div>
                            <div class="h4 mb-0">{{ customer_debts|currency }}</div>
                            <div class="text-muted small">Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="financial-card">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div class="text-muted">Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
                                <i class="fas fa-handshake text-warning"></i>
                            </div>
                            <div class="h4 mb-0">{{ supplier_debts|currency }}</div>
                            <div class="text-muted small">Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
        <div class="col-12 mb-4">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-chart-line me-2 text-primary"></i>
                        ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
                    </h5>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary chart-period-btn" data-period="day">Ø§Ù„ÙŠÙˆÙ…</button>
                        <button class="btn btn-sm btn-outline-primary chart-period-btn" data-period="week">Ø£Ø³Ø¨ÙˆØ¹</button>
                        <button class="btn btn-sm btn-outline-primary chart-period-btn" data-period="month">Ø´Ù‡Ø±</button>
                        <button class="btn btn-sm btn-outline-primary chart-period-btn active" data-period="year">Ø³Ù†Ø©</button>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="chart-tabs">
                            <div class="chart-tab active" data-chart="sales-purchases">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                            <div class="chart-tab" data-chart="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</div>
                            <div class="chart-tab" data-chart="customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="mainChart"></canvas>
                        </div>
                        <div class="chart-legend mt-3">
                            <div class="chart-legend-item">
                                <div class="chart-legend-color" style="background-color: var(--primary-color);"></div>
                                <div class="chart-legend-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                            </div>
                            <div class="chart-legend-item">
                                <div class="chart-legend-color" style="background-color: var(--warning-color);"></div>
                                <div class="chart-legend-label">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="financial-card mb-3">
                            <h6 class="mb-3 fw-bold" id="performanceSummaryTitle">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h6>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                                    <span class="fw-bold" id="performanceSalesTotal">{{ sales_month.total|default:0|currency }}</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-primary" id="performanceSalesProgress" role="progressbar" style="width: {% widthratio sales_month.total|default:0 sales_month.total|default:1|add:purchases_month.total|default:1 100 %}%"></div>
                                </div>
                                <small class="text-muted" id="performanceSalesCount">{{ sales_month.count|default:0 }} ÙØ§ØªÙˆØ±Ø©</small>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
                                    <span class="fw-bold" id="performancePurchasesTotal">{{ purchases_month.total|default:0|currency }}</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-warning" id="performancePurchasesProgress" role="progressbar" style="width: {% widthratio purchases_month.total|default:0 sales_month.total|default:1|add:purchases_month.total|default:1 100 %}%"></div>
                                </div>
                                <small class="text-muted" id="performancePurchasesCount">{{ purchases_month.count|default:0 }} ÙØ§ØªÙˆØ±Ø©</small>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small text-muted">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</span>
                                    <span class="fw-bold" id="performanceProfit">{{ profit_month|default:0|currency }}</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar" id="performanceProfitProgress" role="progressbar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="financial-card">
                            <h6 class="mb-3 fw-bold">Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø£Ø±ØµØ¯Ø©</h6>
                            <div class="mb-3">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-users text-primary me-2"></i>
                                        <span class="small fw-bold">Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                                    </div>
                                    <h6 class="mb-0 text-primary">{{ customer_debts|currency }}</h6>
                                </div>
                            </div>
                            <div>
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-handshake text-warning me-2"></i>
                                        <span class="small fw-bold">Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</span>
                                    </div>
                                    <h6 class="mb-0 text-warning">{{ supplier_debts|currency }}</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        const salesData = {{ chart_sales_data|safe }};
        const purchasesData = {{ chart_purchases_data|safe }};
        const months = {{ chart_months|safe }};
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ§Ù„Ø´Ù‡Ø±
        const salesByHour = {{ chart_sales_by_hour|safe }};
        const purchasesByHour = {{ chart_purchases_by_hour|safe }};
        const salesByDay = {{ chart_sales_by_day|safe }};
        const purchasesByDay = {{ chart_purchases_by_day|safe }};
        const daysAr = {{ chart_days|safe }};
        const salesByWeek = {{ chart_sales_by_week|safe }};
        const purchasesByWeek = {{ chart_purchases_by_week|safe }};
        const weekLabels = {{ chart_week_labels|safe }};
        
        // Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡
        const topProductsLabels = {{ top_products_labels|safe }};
        const topProductsData = {{ top_products_data|safe }};
        const topCustomersLabels = {{ top_customers_labels|safe }};
        const topCustomersData = {{ top_customers_data|safe }};
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        const ctx = document.getElementById('mainChart').getContext('2d');
        let mainChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
                        data: salesData,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',  // Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­
                        borderColor: '#3b82f6',  // Ø£Ø²Ø±Ù‚
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    },
                    {
                        label: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª',
                        data: purchasesData,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',  // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­
                        borderColor: '#10b981',  // Ø£Ø®Ø¶Ø±
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        titleFont: {
                            size: 12,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 12
                        },
                        padding: 10,
                        displayColors: true,
                        callbacks: {
                            labelColor: function(context) {
                                const colors = ['rgba(var(--primary-rgb), 1)', 'rgba(var(--warning-rgb), 1)'];
                                return {
                                    borderColor: 'white',
                                    backgroundColor: colors[context.datasetIndex]
                                };
                            },
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' {{ currency_symbol }}';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false,
                            offset: true
                        },
                        ticks: {
                            font: {
                                size: 10
                            }
                        }
                    },
                    y: {
                        grid: {
                            borderDash: [2, 2],
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                size: 11
                            },
                            callback: function(value) {
                                if (value >= 1000) {
                                    return (value / 1000) + 'k';
                                }
                                return value;
                            }
                        },
                        beginAtZero: true
                    }
                },
                layout: {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 10,
                        bottom: 10
                    }
                },
                barPercentage: 0.7,
                categoryPercentage: 0.8
            }
        });
        
        // ØªØºÙŠÙŠØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        const periodButtons = document.querySelectorAll('.chart-period-btn');
        periodButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                periodButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
                const period = this.dataset.period;
                console.log('ğŸ”˜ ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ÙØªØ±Ø©:', period);
                updateChartData(period);
                updateFinancialSummary(period);
            });
        });
        
        // ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        const chartTabs = document.querySelectorAll('.chart-tab');
        chartTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                chartTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // ØªØ­Ø¯ÙŠØ« Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
                const chartType = this.dataset.chart;
                updateChartType(chartType);
            });
        });
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©
        function updateChartData(period) {
            let labels, data1, data2;
            
            switch(period) {
                case 'day':
                    labels = ['8 Øµ', '10 Øµ', '12 Ù…', '2 Ù…', '4 Ù…', '6 Ù…', '8 Ù…'];
                    data1 = salesByHour;
                    data2 = purchasesByHour;
                    break;
                case 'week':
                    labels = daysAr;
                    data1 = salesByDay;
                    data2 = purchasesByDay;
                    break;
                case 'month':
                    labels = weekLabels;
                    data1 = salesByWeek;
                    data2 = purchasesByWeek;
                    break;
                case 'year':
                default:
                    labels = months;
                    data1 = salesData;
                    data2 = purchasesData;
                    break;
            }
            
            mainChart.data.labels = labels;
            mainChart.data.datasets[0].data = data1;
            mainChart.data.datasets[1].data = data2;
            mainChart.update();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        function updateChartType(chartType) {
            let labels, datasets;
            
            switch(chartType) {
                case 'products':
                    labels = topProductsLabels.length > 0 ? topProductsLabels : ['Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'];
                    datasets = [{
                        label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
                        data: topProductsData.length > 0 ? topProductsData : [0],
                        backgroundColor: [
                            '#3b82f6',  // Ø£Ø²Ø±Ù‚
                            '#10b981',  // Ø£Ø®Ø¶Ø±
                            '#f59e0b',  // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
                            '#8b5cf6',  // Ø¨Ù†ÙØ³Ø¬ÙŠ
                            '#ef4444'   // Ø£Ø­Ù…Ø±
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }];
                    mainChart.config.type = 'bar';
                    break;
                case 'customers':
                    labels = topCustomersLabels.length > 0 ? topCustomersLabels : ['Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'];
                    datasets = [{
                        label: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª',
                        data: topCustomersData.length > 0 ? topCustomersData : [0],
                        backgroundColor: [
                            '#3b82f6',  // Ø£Ø²Ø±Ù‚
                            '#10b981',  // Ø£Ø®Ø¶Ø±
                            '#f59e0b',  // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
                            '#8b5cf6',  // Ø¨Ù†ÙØ³Ø¬ÙŠ
                            '#ef4444'   // Ø£Ø­Ù…Ø±
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }];
                    mainChart.config.type = 'bar';
                    break;
                case 'sales-purchases':
                default:
                    labels = months;
                    datasets = [
                        {
                            label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
                            data: salesData,
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderColor: '#3b82f6',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª',
                            data: purchasesData,
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderColor: '#10b981',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverRadius: 7
                        }
                    ];
                    mainChart.config.type = 'line';
                    break;
            }
            
            mainChart.data.labels = labels;
            mainChart.data.datasets = datasets;
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ´Ø§Ø±Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (chartType === 'products' || chartType === 'customers') {
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù€ Bar Chart
                mainChart.options.scales.x.offset = true;
                mainChart.options.layout = {
                    padding: {
                        left: 10,
                        right: 10,
                        top: 10,
                        bottom: 10
                    }
                };
            } else {
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù€ Line Chart
                mainChart.options.scales.x.offset = false;
                mainChart.options.layout = {
                    padding: {
                        left: 0,
                        right: 0,
                        top: 0,
                        bottom: 0
                    }
                };
            }
            
            mainChart.update();
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© (Legend)
            updateChartLegend(chartType);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        function updateChartLegend(chartType) {
            const legendContainer = document.querySelector('.chart-legend');
            let legendHTML = '';
            
            const colors = [
                '#3b82f6',  // Ø£Ø²Ø±Ù‚
                '#10b981',  // Ø£Ø®Ø¶Ø±
                '#f59e0b',  // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
                '#8b5cf6',  // Ø¨Ù†ÙØ³Ø¬ÙŠ
                '#ef4444'   // Ø£Ø­Ù…Ø±
            ];
            
            switch(chartType) {
                case 'products':
                    if (topProductsLabels.length > 0) {
                        topProductsLabels.forEach((label, index) => {
                            legendHTML += `
                                <div class="chart-legend-item">
                                    <div class="chart-legend-color" style="background-color: ${colors[index % colors.length]};"></div>
                                    <div class="chart-legend-label">${label}</div>
                                </div>
                            `;
                        });
                    } else {
                        legendHTML = `
                            <div class="chart-legend-item">
                                <div class="chart-legend-label">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>
                            </div>
                        `;
                    }
                    break;
                case 'customers':
                    if (topCustomersLabels.length > 0) {
                        topCustomersLabels.forEach((label, index) => {
                            legendHTML += `
                                <div class="chart-legend-item">
                                    <div class="chart-legend-color" style="background-color: ${colors[index % colors.length]};"></div>
                                    <div class="chart-legend-label">${label}</div>
                                </div>
                            `;
                        });
                    } else {
                        legendHTML = `
                            <div class="chart-legend-item">
                                <div class="chart-legend-label">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>
                            </div>
                        `;
                    }
                    break;
                case 'sales-purchases':
                default:
                    legendHTML = `
                        <div class="chart-legend-item">
                            <div class="chart-legend-color" style="background-color: #3b82f6;"></div>
                            <div class="chart-legend-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                        </div>
                        <div class="chart-legend-item">
                            <div class="chart-legend-color" style="background-color: #10b981;"></div>
                            <div class="chart-legend-label">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                        </div>
                    `;
                    break;
            }
            
            legendContainer.innerHTML = legendHTML;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©
        function updateFinancialSummary(period) {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„ÙØªØ±Ø©:', period);
            let title, periodText, salesTotal, purchasesTotal;
            
            switch(period) {
                case 'day':
                    title = 'Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ù„ÙŠÙˆÙ…';
                    periodText = 'Ø§Ù„ÙŠÙˆÙ…';
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…
                    salesTotal = salesByHour.reduce((a, b) => a + b, 0);
                    purchasesTotal = purchasesByHour.reduce((a, b) => a + b, 0);
                    break;
                case 'week':
                    title = 'Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    periodText = 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                    salesTotal = salesByDay.reduce((a, b) => a + b, 0);
                    purchasesTotal = purchasesByDay.reduce((a, b) => a + b, 0);
                    break;
                case 'month':
                    title = 'Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    periodText = 'Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ';
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±
                    salesTotal = salesByWeek.reduce((a, b) => a + b, 0);
                    purchasesTotal = purchasesByWeek.reduce((a, b) => a + b, 0);
                    break;
                case 'year':
                default:
                    title = 'Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ - Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©';
                    periodText = 'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©';
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù†Ø©
                    salesTotal = salesData.reduce((a, b) => a + b, 0);
                    purchasesTotal = purchasesData.reduce((a, b) => a + b, 0);
                    break;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            document.getElementById('financialSummaryTitle').textContent = title;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            document.getElementById('salesTotal').textContent = formatCurrency(salesTotal);
            document.getElementById('salesPeriod').textContent = periodText;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
            document.getElementById('purchasesTotal').textContent = formatCurrency(purchasesTotal);
            document.getElementById('purchasesPeriod').textContent = periodText;
            
            // ØªØ­Ø¯ÙŠØ« ÙƒØ§Ø±Øª Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ø§Ù„Ø£ÙŠÙ…Ù†)
            document.getElementById('performanceSummaryTitle').textContent = title;
            document.getElementById('performanceSalesTotal').textContent = formatCurrency(salesTotal);
            document.getElementById('performancePurchasesTotal').textContent = formatCurrency(purchasesTotal);
            
            // Ø­Ø³Ø§Ø¨ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­
            const profit = salesTotal - purchasesTotal;
            const profitElement = document.getElementById('performanceProfit');
            const profitProgressElement = document.getElementById('performanceProfitProgress');
            
            profitElement.textContent = formatCurrency(profit);
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ø±Ø¨Ø­
            if (profit >= 0) {
                profitElement.className = 'fw-bold text-success';
                profitProgressElement.className = 'progress-bar bg-success';
            } else {
                profitElement.className = 'fw-bold text-danger';
                profitProgressElement.className = 'progress-bar bg-danger';
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ Ø§Ù„Ù€ Progress Bars
            const total = salesTotal + purchasesTotal;
            console.log('ğŸ“Š ØªØ­Ø¯ÙŠØ« Progress Bars:', {
                period: period,
                salesTotal: salesTotal,
                purchasesTotal: purchasesTotal,
                total: total
            });
            
            if (total > 0) {
                const salesPercentage = (salesTotal / total) * 100;
                const purchasesPercentage = (purchasesTotal / total) * 100;
                console.log('ğŸ“ˆ Ø§Ù„Ù†Ø³Ø¨ Ø§Ù„Ù…Ø¦ÙˆÙŠØ©:', {
                    salesPercentage: salesPercentage.toFixed(2) + '%',
                    purchasesPercentage: purchasesPercentage.toFixed(2) + '%'
                });
                document.getElementById('performanceSalesProgress').style.width = salesPercentage + '%';
                document.getElementById('performancePurchasesProgress').style.width = purchasesPercentage + '%';
                // progress bar Ø§Ù„Ø±Ø¨Ø­ Ø¯Ø§ÙŠÙ…Ø§Ù‹ 100% (Ù„Ø£Ù†Ù‡ Ø¨ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ)
                document.getElementById('performanceProfitProgress').style.width = '100%';
            } else {
                // ØªØµÙÙŠØ± Progress Bars Ø¹Ù†Ø¯Ù…Ø§ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ = 0
                console.log('ğŸ”„ ØªØµÙÙŠØ± Progress Bars (Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª)');
                document.getElementById('performanceSalesProgress').style.width = '0%';
                document.getElementById('performancePurchasesProgress').style.width = '0%';
                document.getElementById('performanceProfitProgress').style.width = '0%';
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Ù„Ø£Ù†Ù†Ø§ Ù…Ø´ Ø¹Ù†Ø¯Ù†Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠ)
            document.getElementById('performanceSalesCount').style.display = 'none';
            document.getElementById('performancePurchasesCount').style.display = 'none';
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
        function formatCurrency(value) {
            return new Intl.NumberFormat('ar-EG', {
                style: 'decimal',
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(value) + ' {{ currency_symbol }}';
        }
        
        // ØªØ­Ø¯ÙŠØ« progress bars Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„Ø³Ù†Ø©)
        updateFinancialSummary('year');
    });
</script>
{% endblock %} 