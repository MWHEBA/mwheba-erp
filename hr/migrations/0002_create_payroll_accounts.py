# Generated by Django 4.2.25 on 2025-11-11 17:31

from django.db import migrations


def create_payroll_accounts(apps, schema_editor):
    """Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨"""
    ChartOfAccounts = apps.get_model('financial', 'ChartOfAccounts')
    AccountType = apps.get_model('financial', 'AccountType')
    
    # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
    expense_type = AccountType.objects.filter(code='EXPENSE').first()
    current_liability_type = AccountType.objects.filter(code='CURRENT_LIABILITY').first()
    
    if not expense_type or not current_liability_type:
        print("âŒ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©")
        return
    
    # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¨
    expenses_parent = ChartOfAccounts.objects.filter(code='50000').first()  # Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
    liabilities_parent = ChartOfAccounts.objects.filter(code='20000').first()  # Ø§Ù„Ø®ØµÙˆÙ…
    
    if not expenses_parent or not liabilities_parent:
        print("âŒ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©")
        return
    
    # Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø±ÙˆØ§ØªØ¨
    payroll_accounts = [
        # Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© (ØªØ­Ø¯ÙŠØ« ÙÙ‚Ø·)
        {
            'code': '52021',
            'name': 'Ø§Ù„Ø¨Ø¯Ù„Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ©',
            'parent': expenses_parent,
            'account_type': expense_type,
            'description': 'Ø¨Ø¯Ù„Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…',
        },
        {
            'code': '52022',
            'name': 'Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ÙˆØ§Ù„Ø­ÙˆØ§ÙØ²',
            'parent': expenses_parent,
            'account_type': expense_type,
            'description': 'Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ ÙˆÙ…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©',
        },
        {
            'code': '52023',
            'name': 'Ø¨Ø¯Ù„ Ø§Ù„Ø³ÙƒÙ†',
            'parent': expenses_parent,
            'account_type': expense_type,
            'description': 'Ø¨Ø¯Ù„ Ø§Ù„Ø³ÙƒÙ† Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
        },
        
        # Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        {
            'code': '52024',
            'name': 'Ø®ØµÙˆÙ…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§ØªØ¨',
            'parent': expenses_parent,
            'account_type': expense_type,
            'description': 'Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„ØªØ£Ø®ÙŠØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ù…Ù† Ø§Ù„Ø±ÙˆØ§ØªØ¨',
        },
        {
            'code': '52025',
            'name': 'Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© - Ø­ØµØ© Ø§Ù„Ø´Ø±ÙƒØ©',
            'parent': expenses_parent,
            'account_type': expense_type,
            'description': 'Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ© ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
        },
        
        # Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø®ØµÙˆÙ… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© (ØªØ­Ø¯ÙŠØ« ÙÙ‚Ø·)
        {
            'code': '21031',
            'name': 'Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© - Ø­ØµØ© Ø§Ù„Ø¹Ø§Ù…Ù„',
            'parent': liabilities_parent,
            'account_type': current_liability_type,
            'description': 'Ø®ØµÙ… Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù…Ù† Ø±Ø§ØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù',
        },
        {
            'code': '21032',
            'name': 'Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¯Ø®Ù„',
            'parent': liabilities_parent,
            'account_type': current_liability_type,
            'description': 'Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
        },
        {
            'code': '21033',
            'name': 'Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø©',
            'parent': liabilities_parent,
            'account_type': current_liability_type,
            'description': 'Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù†Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©',
        },
        {
            'code': '21034',
            'name': 'Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø·Ø¨ÙŠ',
            'parent': liabilities_parent,
            'account_type': current_liability_type,
            'description': 'Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø·Ø¨ÙŠ',
        },
    ]
    
    created_count = 0
    updated_count = 0
    
    for account_data in payroll_accounts:
        account, created = ChartOfAccounts.objects.get_or_create(
            code=account_data['code'],
            defaults={
                'name': account_data['name'],
                'parent': account_data['parent'],
                'account_type': account_data['account_type'],
                'description': account_data['description'],
                'is_active': True
            }
        )
        
        if created:
            created_count += 1
            print(f"âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨: {account.code} - {account.name}")
        else:
            # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯
            account.name = account_data['name']
            account.parent = account_data['parent']
            account.account_type = account_data['account_type']
            account.description = account_data['description']
            account.save()
            updated_count += 1
            print(f"ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø³Ø§Ø¨: {account.code} - {account.name}")
    
    print(f"ğŸ“Š ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ {created_count} Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØªØ­Ø¯ÙŠØ« {updated_count} Ø­Ø³Ø§Ø¨")


def reverse_create_payroll_accounts(apps, schema_editor):
    """Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© Ù„Ù„Ø±ÙˆØ§ØªØ¨"""
    ChartOfAccounts = apps.get_model('financial', 'ChartOfAccounts')
    
    account_codes = ['52021', '52022', '52023', '52024', '52025', '21031', '21032', '21033', '21034']
    deleted_count = 0
    
    for code in account_codes:
        deleted, _ = ChartOfAccounts.objects.filter(code=code).delete()
        if deleted:
            deleted_count += deleted
            print(f"ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨: {code}")
    
    print(f"ğŸ“Š ØªÙ… Ø­Ø°Ù {deleted_count} Ø­Ø³Ø§Ø¨")


class Migration(migrations.Migration):

    dependencies = [
        ("hr", "0001_initial"),
        ("financial", "0003_load_chart_of_accounts"),
    ]

    operations = [
        migrations.RunPython(
            create_payroll_accounts,
            reverse_create_payroll_accounts,
            elidable=True
        ),
    ]
