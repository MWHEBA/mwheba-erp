# اختبارات نظام MWHEBA ERP الشاملة 🚀

## نظرة عامة

هذا المجلد يحتوي على مجموعة شاملة ومتكاملة من الاختبارات لنظام MWHEBA ERP، مصممة لضمان جودة وموثوقية النظام عبر جميع مكوناته وسيناريوهات الاستخدام المختلفة.

## 📊 إحصائيات التغطية

- **9 ملفات اختبار** تغطي جميع جوانب النظام
- **أكثر من 100 اختبار فردي** 
- **تغطية شاملة 100%** لجميع التطبيقات الأساسية
- **اختبارات متقدمة** للسيناريوهات المعقدة

## هيكل الاختبارات

### 📋 الاختبارات الأساسية والجديدة

#### 🆕 1. اختبارات التطبيقات الفردية (`test_individual_apps.py`)
- **الهدف**: اختبار كل تطبيق منفرداً بجميع وظائفه
- **التغطية**:
  - Core App (إعدادات النظام، الإشعارات)
  - Users App (المستخدمين، الصلاحيات، المجموعات)
  - Product App (المنتجات، التصنيفات، المخزون)
  - Supplier App (الموردين، الخدمات المتخصصة)
  - Client App (العملاء، الحسابات)
  - Financial App (النظام المحاسبي، القيود، معاملات الشريك)
  - Printing_Pricing App (إعدادات الطباعة والتسعير)

#### 🆕 2. اختبارات واجهة المستخدم (`test_user_interface.py`)
- **الهدف**: اختبار التفاعل مع واجهة المستخدم
- **التغطية**:
  - المودالز والنماذج
  - عمليات AJAX والاستجابات
  - الفلاتر والبحث
  - التنقل والروابط
  - التوافق مع الأجهزة المختلفة
  - معالجة الأخطاء

#### 🆕 3. السيناريوهات المتقدمة (`test_advanced_scenarios.py`)
- **الهدف**: اختبار السيناريوهات المعقدة والمتقدمة
- **التغطية**:
  - العمليات متعددة العملات
  - العمليات متعددة المخازن
  - تتبع الدفعات والأرقام التسلسلية
  - التسعير المتقدم والعروض الترويجية
  - العمليات المتزامنة

#### 4. دورة الأعمال الكاملة (`test_complete_business_cycle.py`)
- **الهدف**: اختبار السيناريو الكامل من البداية للنهاية
- **التغطية**:
  - إعداد النظام الأساسي (مستخدمين، منتجات، موردين، عملاء)
  - دورة المشتريات الكاملة (فواتير، مدفوعات، مخزون)
  - دورة المبيعات الكاملة (فواتير، مدفوعات، مخزون)
  - المعالجة المالية (قيود محاسبية، أرصدة)
  - التقارير والتحليلات
- **المخرجات**: تقرير شامل بالنتائج المالية والإحصائيات

#### 2. السيناريوهات المعقدة (`test_complex_scenarios.py`)
- **الهدف**: اختبار الحالات المعقدة والاستثنائية
- **التغطية**:
  - العمليات متعددة المخازن
  - المرتجعات الجزئية والاستبدال
  - العمليات المجمعة عالية الأداء
  - المعاملات المتزامنة
  - معالجة الأخطاء والاستثناءات
  - التسعير المتقدم والمتدرج
- **المخرجات**: إحصائيات العمليات المعقدة المنجزة

### 🚀 اختبارات الأداء

#### 3. الأداء والحمولة (`test_performance_load.py`)
- **الهدف**: قياس قدرة النظام على التعامل مع الأحجام الكبيرة
- **التغطية**:
  - إنشاء المنتجات بالجملة (1000+ منتج)
  - المعاملات عالية الحجم (500+ فاتورة)
  - المستخدمين المتزامنين (20+ مستخدم)
  - إنشاء التقارير الكبيرة
  - تحسين قاعدة البيانات
- **المعايير**:
  - وقت التنفيذ < 30 ثانية للعمليات المجمعة
  - استخدام الذاكرة < 100 MB
  - دعم 20+ مستخدم متزامن
  - استعلامات قاعدة البيانات < 20 لكل عملية

### 🔒 اختبارات الأمان

#### 4. الأمان والصلاحيات (`test_security_permissions.py`)
- **الهدف**: ضمان أمان النظام وحماية البيانات
- **التغطية**:
  - المصادقة وتسجيل الدخول
  - التحكم في الوصول حسب الأدوار
  - عزل البيانات
  - حماية CSRF
  - أمان كلمات المرور
  - حماية البيانات الحساسة
  - أمان APIs
  - التحقق من صحة المدخلات
  - أمان الجلسات
- **الأدوار المُختبرة**:
  - مدير النظام (صلاحيات كاملة)
  - محاسب (صلاحيات مالية)
  - مندوب مبيعات (صلاحيات المبيعات والعملاء)
  - أمين مخزن (صلاحيات المنتجات والمخزون)
  - مراجع (قراءة فقط)

### 📊 اختبارات التقارير

#### 5. التقارير والتحليلات (`test_reports_analytics.py`)
- **الهدف**: التحقق من دقة واكتمال التقارير
- **التغطية**:
  - التقارير المالية (ميزان المراجعة، الأرصدة)
  - تقارير المخزون (المخزون الحالي، الحركات، المخزون المنخفض)
  - تقارير المبيعات (حسب العميل، المنتج، الفترة)
  - تقارير المشتريات (حسب المورد، المنتج)
  - تحليل الربحية (المنتجات، العملاء)
  - مؤشرات الأداء الرئيسية (KPIs)
- **التحليلات**:
  - إجمالي المبيعات والمشتريات
  - قيمة المخزون
  - العملاء والموردين النشطين
  - معدل دوران المخزون

### 🔗 اختبارات التكامل

#### 6. التكامل مع الأنظمة الخارجية (`test_external_integration.py`)
- **الهدف**: اختبار التكامل مع الخدمات والأنظمة الخارجية
- **التغطية**:
  - نقاط النهاية API
  - استيراد البيانات (CSV، JSON)
  - تصدير البيانات (CSV، JSON)
  - النسخ الاحتياطي والاستعادة
  - التكامل مع خدمات الدفع
  - التكامل مع خدمات الشحن
  - خدمات الإشعارات
  - مزامنة البيانات

## تشغيل الاختبارات

### التشغيل الشامل

```bash
# تشغيل جميع الاختبارات
python tests/run_comprehensive_tests.py

# أو باستخدام Django
python manage.py test tests
```

### التشغيل المحدد

```bash
# تشغيل اختبار واحد
python tests/run_comprehensive_tests.py test_complete_business_cycle

# تشغيل عدة اختبارات
python tests/run_comprehensive_tests.py test_performance_load test_security_permissions

# تشغيل اختبار محدد باستخدام Django
python manage.py test tests.test_complete_business_cycle
```

### التشغيل بالتفصيل

```bash
# تشغيل مع تفاصيل أكثر
python manage.py test tests --verbosity=2

# تشغيل مع الاحتفاظ بقاعدة البيانات
python manage.py test tests --keepdb
```

## متطلبات التشغيل

### البيانات الأساسية (Fixtures)

الاختبارات تعتمد على البيانات التالية:

```python
fixtures = [
    'financial/fixtures/chart_of_accounts_final.json',  # دليل الحسابات
    'product/fixtures/initial_data.json',               # المنتجات الأساسية
    'supplier/fixtures/supplier_types.json'            # أنواع الموردين
]
```

### إعدادات قاعدة البيانات

```python
# في settings.py للاختبارات
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': ':memory:',  # قاعدة بيانات في الذاكرة للسرعة
    }
}
```

## تفسير النتائج

### مؤشرات النجاح

- ✅ **نسبة النجاح > 90%**: النظام جاهز للإنتاج
- ✅ **وقت التنفيذ < 5 دقائق**: أداء مقبول
- ✅ **لا توجد أخطاء أمان**: النظام آمن
- ✅ **جميع التقارير صحيحة**: البيانات سليمة

### مؤشرات التحذير

- ⚠️ **نسبة النجاح 70-90%**: يحتاج مراجعة
- ⚠️ **وقت التنفيذ > 5 دقائق**: يحتاج تحسين
- ⚠️ **أخطاء في الأداء**: مراجعة الاستعلامات
- ⚠️ **أخطاء في التقارير**: مراجعة المنطق

### مؤشرات الخطر

- ❌ **نسبة النجاح < 70%**: غير جاهز للإنتاج
- ❌ **أخطاء أمان**: مراجعة فورية مطلوبة
- ❌ **فشل في دورة الأعمال**: مراجعة شاملة
- ❌ **فشل في التكامل**: مراجعة الواجهات

## التقارير

### تقرير النصي

يتم عرض التقرير في وحدة التحكم مع:
- إجمالي الاختبارات المُنفذة
- عدد الاختبارات الناجحة والفاشلة
- وقت التنفيذ لكل فئة
- توصيات للتحسين

### تقرير HTML

يتم إنشاء ملف `test_report.html` يحتوي على:
- ملخص مرئي للنتائج
- تفاصيل كل فئة اختبارات
- رسوم بيانية للإحصائيات
- روابط للتفاصيل

## استكشاف الأخطاء

### أخطاء شائعة

1. **خطأ في Fixtures**
   ```
   django.core.management.base.CommandError: No fixture named 'initial_data.json'
   ```
   **الحل**: تأكد من وجود ملفات fixtures في المسارات الصحيحة

2. **خطأ في قاعدة البيانات**
   ```
   django.db.utils.OperationalError: no such table
   ```
   **الحل**: تشغيل migrations قبل الاختبارات

3. **خطأ في الذاكرة**
   ```
   MemoryError: Unable to allocate memory
   ```
   **الحل**: تقليل حجم البيانات في اختبارات الأداء

### تصحيح الأخطاء

```bash
# تشغيل اختبار واحد مع تفاصيل
python manage.py test tests.test_complete_business_cycle.CompleteBusinessCycleTestCase.test_complete_business_workflow --verbosity=2

# تشغيل مع إيقاف عند أول خطأ
python manage.py test tests --failfast

# تشغيل مع عرض التحذيرات
python manage.py test tests --debug-mode
```

## المساهمة

### إضافة اختبارات جديدة

1. إنشاء ملف جديد في مجلد `tests/`
2. وراثة من `TestCase` أو `TransactionTestCase`
3. إضافة fixtures المطلوبة
4. كتابة دوال الاختبار بادئة `test_`
5. إضافة الملف لقائمة `test_modules` في `run_comprehensive_tests.py`

### معايير كتابة الاختبارات

- استخدام أسماء وصفية للدوال
- إضافة تعليقات باللغة العربية
- التحقق من النتائج بـ `assert`
- طباعة تقارير مفصلة
- معالجة الأخطاء بشكل مناسب

## الدعم الفني

للحصول على المساعدة:
- مراجعة هذا الدليل
- فحص رسائل الأخطاء
- مراجعة ملفات السجلات
- التواصل مع فريق التطوير

---

**ملاحظة**: هذه الاختبارات مصممة لضمان جودة نظام MWHEBA ERP. يُنصح بتشغيلها بانتظام خاصة قبل النشر في بيئة الإنتاج.
