# نظام الموارد البشرية - دليل شامل

## نظرة عامة

نظام شامل لإدارة الموارد البشرية يشمل الموظفين، الحضور، الإجازات، والبصمة.

---

## المكونات الرئيسية

### 1. إدارة الموظفين
- **الموظفون**: `/hr/employees/`
- **الأقسام**: `/hr/departments/`
- **المسميات الوظيفية**: `/hr/job-titles/`
- **الورديات**: `/hr/shifts/`

### 2. نظام الحضور
- **سجل الحضور**: `/hr/attendance/`
- **التقارير**: `/hr/attendance/reports/`
- **الإحصائيات**: Dashboard

### 3. نظام البصمة
- **لوحة التحكم**: `/hr/biometric/dashboard/`
- **الأجهزة**: `/hr/biometric-devices/`
- **السجلات**: `/hr/biometric-logs/`
- **الربط**: `/hr/biometric/mapping/`

### 4. نظام الإجازات
- **طلبات الإجازات**: `/hr/leaves/`
- **أنواع الإجازات**: `/hr/leave-types/`
- **الموافقات**: Workflow

---

## الموظفون

### إضافة موظف جديد
1. اذهب إلى `/hr/employees/add/`
2. املأ البيانات الأساسية
3. حدد القسم والمسمى الوظيفي
4. اختر الوردية (اختياري)
5. احفظ

### ربط الموظف بالبصمة
1. افتح صفحة الموظف
2. في قسم "نظام البصمة"
3. اضغط "ربط بالبصمة"
4. أدخل `user_id` من جهاز البصمة

### ربط الموظف بحساب مستخدم
1. افتح صفحة الموظف
2. في قسم "حساب المستخدم"
3. اضغط "إنشاء حساب"
4. سيتم إنشاء حساب تلقائياً

---

## الحضور والانصراف

### عرض سجل الحضور
- **الصفحة**: `/hr/attendance/`
- **الفلترة**: حسب التاريخ، القسم، الموظف
- **التصدير**: Excel, PDF

### البيانات المعروضة
- التاريخ واليوم
- الموظف والقسم
- وقت الحضور والانصراف
- ساعات العمل
- التأخير والانصراف المبكر
- عدد الحركات
- الحالة

### تنسيق البيانات
- **ساعات العمل**: 
  - أقل من 90 دقيقة: "45 دقيقة"
  - أكثر من 90 دقيقة: "8 ساعات و 30 دقيقة"
- **التأخير**: 
  - أقل من 90 دقيقة: "30 د"
  - أكثر من 90 دقيقة: "2س 15د"

---

## الورديات

### إنشاء وردية جديدة
```python
Shift.objects.create(
    name='الوردية الصباحية',
    start_time='09:00',
    end_time='17:00',
    work_hours=8.0,
    is_active=True
)
```

### تعيين وردية لموظف
1. افتح صفحة الموظف
2. اضغط "تعديل"
3. اختر الوردية من القائمة
4. احفظ

---

## APIs

### جلب بيانات موظف
```http
GET /hr/api/employees/{id}/
Authorization: Token your-token-here
```

### تسجيل حضور (من البصمة)
```http
POST /hr/api/biometric/bridge/sync/
Authorization: Bearer agent-secret
Content-Type: application/json

{
    "agent_code": "DEVICE001",
    "records": [
        {
            "user_id": "123",
            "timestamp": "2025-11-05T09:00:00",
            "device_sn": "ABC123"
        }
    ]
}
```

---

## صفحة تفاصيل الموظف

### العمود الأيسر (Sidebar)
1. **الصورة والمعلومات الأساسية**
   - الصورة الشخصية
   - الاسم الكامل
   - رقم الموظف

2. **معلومات سريعة**
   - القسم
   - المسمى الوظيفي
   - تاريخ التعيين
   - الحالة

3. **حساب المستخدم**
   - حالة الحساب
   - زر إنشاء/عرض الحساب

4. **الوردية**
   - اسم الوردية
   - أوقات العمل
   - ساعات العمل

### العمود الأيمن (Content)
1. **المعلومات الوظيفية**
   - القسم
   - المسمى الوظيفي
   - نوع التوظيف
   - المدير المباشر

2. **المعلومات الشخصية**
   - تاريخ الميلاد
   - الجنس
   - الحالة الاجتماعية
   - الديانة

3. **معلومات الاتصال**
   - البريد الوظيفي
   - الهاتف المحمول
   - المدينة
   - العنوان

4. **نظام البصمة**
   - حالة الربط
   - رقم الموظف في البصمة
   - إحصائيات البصمة
   - آخر 5 بصمات

---

## التقارير

### تقرير الحضور الشهري
```python
from hr.models import BiometricLog
from datetime import date, timedelta

# جلب سجلات الشهر
start_date = date.today().replace(day=1)
end_date = date.today()

logs = BiometricLog.objects.filter(
    employee=employee,
    timestamp__date__gte=start_date,
    timestamp__date__lte=end_date
).order_by('timestamp')

# حساب أيام الحضور
attendance_days = logs.values('timestamp__date').distinct().count()
```

### تقرير التأخير
```python
# جلب سجلات التأخير
late_logs = BiometricLog.objects.filter(
    employee=employee,
    timestamp__date__gte=start_date,
    timestamp__date__lte=end_date
).annotate(
    check_in_time=Min('timestamp')
).filter(
    check_in_time__gt=F('employee__shift__start_time')
)
```

---

## الصلاحيات

### صلاحيات الموظفين
- `hr.view_employee` - عرض الموظفين
- `hr.add_employee` - إضافة موظف
- `hr.change_employee` - تعديل موظف
- `hr.delete_employee` - حذف موظف

### صلاحيات الحضور
- `hr.view_attendance` - عرض الحضور
- `hr.add_attendance` - تسجيل حضور
- `hr.change_attendance` - تعديل حضور

### صلاحيات البصمة
- `hr.view_biometriclog` - عرض سجلات البصمة
- `hr.view_biometricdevice` - عرض أجهزة البصمة
- `hr.add_biometricusermapping` - إضافة ربط

---

## التكامل

### مع نظام المستخدمين
- كل موظف يمكن ربطه بحساب مستخدم
- الربط التلقائي عند الإنشاء (اختياري)
- مزامنة البيانات الأساسية

### مع نظام البصمة
- ربط تلقائي عبر `BiometricUserMapping`
- مزامنة السجلات من الأجهزة
- حسابات تلقائية للحضور

### مع نظام المرتبات
- حساب أيام الحضور
- حساب الساعات الإضافية
- خصم الغياب والتأخير

---

## الخلاصة

### النظام يوفر:
- ✅ إدارة شاملة للموظفين
- ✅ تتبع دقيق للحضور
- ✅ تكامل مع البصمة
- ✅ تقارير تفصيلية
- ✅ APIs كاملة

### الحالة:
- ✅ مكتمل ومُختبر
- ✅ جاهز للإنتاج
- ✅ موثق بالكامل

---

**آخر تحديث:** 2025-11-05  
**الإصدار:** 2.0.0  
**الحالة:** ✅ مكتمل
