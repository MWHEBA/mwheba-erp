# Generated by Django 4.2.7 on 2025-09-28 15:57

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ("financial", "0006_accountbalancecache_balanceauditlog_and_more"),
    ]

    operations = [
        migrations.CreateModel(
            name="BankReconciliation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "reconciliation_date",
                    models.DateField(
                        default=django.utils.timezone.now, verbose_name="تاريخ التسوية"
                    ),
                ),
                (
                    "system_balance",
                    models.DecimalField(
                        decimal_places=2, max_digits=15, verbose_name="رصيد النظام"
                    ),
                ),
                (
                    "bank_balance",
                    models.DecimalField(
                        decimal_places=2, max_digits=15, verbose_name="رصيد البنك"
                    ),
                ),
                (
                    "difference",
                    models.DecimalField(
                        decimal_places=2, max_digits=15, verbose_name="الفرق"
                    ),
                ),
                (
                    "bank_statement_reference",
                    models.CharField(
                        blank=True,
                        max_length=100,
                        null=True,
                        verbose_name="مرجع كشف الحساب",
                    ),
                ),
                (
                    "notes",
                    models.TextField(blank=True, null=True, verbose_name="ملاحظات"),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "قيد المراجعة"),
                            ("approved", "معتمدة"),
                            ("rejected", "مرفوضة"),
                        ],
                        default="pending",
                        max_length=20,
                        verbose_name="الحالة",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, verbose_name="تاريخ الإنشاء"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(auto_now=True, verbose_name="تاريخ التحديث"),
                ),
                (
                    "approved_at",
                    models.DateTimeField(
                        blank=True, null=True, verbose_name="تاريخ الاعتماد"
                    ),
                ),
                (
                    "account",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="bank_reconciliations",
                        to="financial.chartofaccounts",
                        verbose_name="الحساب",
                    ),
                ),
                (
                    "approved_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="approved_reconciliations",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="اعتمد بواسطة",
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="bank_reconciliations",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="أنشئ بواسطة",
                    ),
                ),
                (
                    "journal_entry",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="bank_reconciliations",
                        to="financial.journalentry",
                        verbose_name="القيد المحاسبي",
                    ),
                ),
            ],
            options={
                "verbose_name": "تسوية بنكية",
                "verbose_name_plural": "التسويات البنكية",
                "ordering": ["-reconciliation_date", "-created_at"],
            },
        ),
        migrations.CreateModel(
            name="BankReconciliationItem",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "item_type",
                    models.CharField(
                        choices=[
                            ("deposit_in_transit", "إيداعات في الطريق"),
                            ("outstanding_check", "شيكات معلقة"),
                            ("bank_charge", "رسوم بنكية"),
                            ("bank_interest", "فوائد بنكية"),
                            ("error_correction", "تصحيح خطأ"),
                            ("other", "أخرى"),
                        ],
                        max_length=30,
                        verbose_name="نوع البند",
                    ),
                ),
                ("description", models.CharField(max_length=200, verbose_name="الوصف")),
                (
                    "amount",
                    models.DecimalField(
                        decimal_places=2, max_digits=15, verbose_name="المبلغ"
                    ),
                ),
                (
                    "reference",
                    models.CharField(
                        blank=True, max_length=100, null=True, verbose_name="المرجع"
                    ),
                ),
                (
                    "effect",
                    models.CharField(
                        choices=[
                            ("add_to_book", "إضافة لرصيد الدفاتر"),
                            ("subtract_from_book", "خصم من رصيد الدفاتر"),
                            ("add_to_bank", "إضافة لرصيد البنك"),
                            ("subtract_from_bank", "خصم من رصيد البنك"),
                        ],
                        max_length=30,
                        verbose_name="التأثير",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, verbose_name="تاريخ الإنشاء"
                    ),
                ),
                (
                    "reconciliation",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="items",
                        to="financial.bankreconciliation",
                        verbose_name="التسوية",
                    ),
                ),
            ],
            options={
                "verbose_name": "بند تسوية بنكية",
                "verbose_name_plural": "بنود التسوية البنكية",
                "ordering": ["item_type", "description"],
            },
        ),
        migrations.AddIndex(
            model_name="bankreconciliation",
            index=models.Index(
                fields=["account", "reconciliation_date"],
                name="financial_b_account_e1787f_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="bankreconciliation",
            index=models.Index(
                fields=["status", "created_at"], name="financial_b_status_0c0148_idx"
            ),
        ),
    ]
